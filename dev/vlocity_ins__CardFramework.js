(function(){var fileNsPrefix=function(){"use strict";var scripts=document.getElementsByTagName("script");var lastScript=scripts[scripts.length-1];var scriptName=lastScript.src;var parts=scriptName.split("/");var thisScript=parts[parts.length-1];if(thisScript===""){thisScript=parts[parts.length-2]}var lowerCasePrefix=thisScript.indexOf("__")==-1?"":thisScript.substring(0,thisScript.indexOf("__")+2);lowerCasePrefix=lowerCasePrefix===""&&localStorage.getItem("nsPrefix")?localStorage.getItem("nsPrefix"):lowerCasePrefix;if(lowerCasePrefix!==""){lowerCasePrefix=/__$/.test(lowerCasePrefix)?lowerCasePrefix:lowerCasePrefix+"__"}if(lowerCasePrefix.length===0){return function(){lowerCasePrefix=window.nsPrefix?window.nsPrefix:lowerCasePrefix;if(lowerCasePrefix!==""){lowerCasePrefix=/__$/.test(lowerCasePrefix)?lowerCasePrefix:lowerCasePrefix+"__"}return lowerCasePrefix}}else{var resolvedNs=null;return function(){if(resolvedNs){return resolvedNs}try{var tofind=lowerCasePrefix.replace("__","");var name;var scanObjectForNs=function(object,alreadySeen){if(object&&object!==window&&alreadySeen.indexOf(object)==-1){alreadySeen.push(object);Object.keys(object).forEach(function(key){if(key==="ns"){if(typeof object[key]==="string"&&object[key].toLowerCase()===tofind){name=object[key]+"__";return false}}if(Object.prototype.toString.call(object[key])==="[object Array]"){object[key].forEach(function(value){var result=scanObjectForNs(value,alreadySeen);if(result){name=result;return false}})}else if(typeof object[key]=="object"){var result=scanObjectForNs(object[key],alreadySeen);if(result){name=result;return false}}if(name){return false}});if(name){return name}}};if(typeof Visualforce!=="undefined"){scanObjectForNs(Visualforce.remoting.Manager.providers,[])}else{return lowerCasePrefix}if(name){return resolvedNs=name}else{return resolvedNs=lowerCasePrefix}}catch(e){return lowerCasePrefix}}}}();var fileNsPrefixDot=function(){var prefix=fileNsPrefix();if(prefix.length>1){return prefix.replace("__",".")}else{return prefix}};
(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
require("./VlocTemplates.js"),angular.module("CardFramework",["vlocity","vlocTemplates","mgcrea.ngStrap","sldsangular"]).config(["$localizableProvider",function($localizableProvider){"use strict";$localizableProvider.setLocalizedMap(window.i18n),$localizableProvider.setDebugMode(""===window.ns)}]).config(["$compileProvider","$logProvider",function($compileProvider,$logProvider){"use strict";var debugMode,params=function(){var query,vars,queryString={};if(query="undefined"!=typeof Visualforce?window.location.search.substring(1):window.location.hash.split("?")[1]){vars=query.split("&");for(var i=0;i<vars.length;i++){var pair=vars[i].split("=");if("undefined"==typeof queryString[pair[0]])queryString[pair[0]]=decodeURIComponent(pair[1]);else if("string"==typeof queryString[pair[0]]){var arr=[queryString[pair[0]],decodeURIComponent(pair[1])];queryString[pair[0]]=arr}else queryString[pair[0]].push(decodeURIComponent(pair[1]))}}return queryString}();debugMode=!!params.debugMode&&"true"===params.debugMode,$compileProvider.debugInfoEnabled(debugMode),$logProvider.debugEnabled(debugMode)}]).config(["$controllerProvider","$windowProvider",function($controllerProvider,$windowProvider){"use strict";$windowProvider.$get().vlocity=$windowProvider.$get().vlocity||{},$windowProvider.$get().vlocity.cardframework=$windowProvider.$get().vlocity.cardframework||{},$windowProvider.$get().vlocity.cardframework.registerModule={controller:$controllerProvider.register}}]).run(["$rootScope","actionService","cardIconFactory","pageService","$timeout","$log",function($rootScope,actionService,cardIconFactory,pageService,$timeout,$log){"use strict";function enhanceLogging(loggingFunc,context){return function(){var modifiedArguments=[].slice.call(arguments);modifiedArguments[0]=["::["+context+"]> "]+modifiedArguments[0],loggingFunc.apply(null,modifiedArguments)}}$rootScope.nsPrefix=fileNsPrefix(),$rootScope.cardIconFactory=cardIconFactory,$log.getInstance=function(context){return{log:enhanceLogging($log.log,context),info:enhanceLogging($log.info,context),warn:enhanceLogging($log.warn,context),debug:enhanceLogging($log.debug,context),error:enhanceLogging($log.error,context)}},actionService.getActionsInfo().then(function(actions){actions?$rootScope.allActions=actions:$rootScope.allActions=[]});var showDigestChart=!!pageService.params.debugMode&&"true"===pageService.params.debugMode;showDigestChart&&"undefined"!=typeof showAngularStats&&$timeout(function(){showAngularStats()},50)}]).config(["remoteActionsProvider",function(remoteActionsProvider){var nsPrefixDotNotation=fileNsPrefixDot(),remoteActions={getUserProfile:{action:nsPrefixDotNotation+"CardCanvasController.getUserProfile",config:{escape:!1,buffer:!1}},getDataViaDynamicSoql:{action:nsPrefixDotNotation+"CardCanvasController.getDataViaDynamicSoql",config:{escape:!1,buffer:!1}},getAccountById:{action:nsPrefixDotNotation+"CardCanvasController.getAccountById",config:{escape:!1,buffer:!1}},getConsoleCardsAction:{action:nsPrefixDotNotation+"CardCanvasController.getConsoleCardsAction",config:{escape:!1,buffer:!1}},getActionsInfo:{action:nsPrefixDotNotation+"CardCanvasController.getActionsInfo",config:{escape:!1,buffer:!1}},getActions:{action:nsPrefixDotNotation+"CardCanvasController.getActionDetails",config:{escape:!1,buffer:!1}},getLayouts:{action:nsPrefixDotNotation+"CardCanvasController.getAllLayouts",config:{escape:!1,buffer:!1}},getLayout:{action:nsPrefixDotNotation+"CardCanvasController.getLayout",config:{escape:!1,buffer:!1}},getLayoutsByName:{action:nsPrefixDotNotation+"CardCanvasController.getLayoutByName",config:{escape:!1,buffer:!1}},getCards:{action:nsPrefixDotNotation+"CardCanvasController.getAllCardDefinitions",config:{escape:!1,buffer:!1}},getCardByName:{action:nsPrefixDotNotation+"CardCanvasController.getCardByName",config:{escape:!1,buffer:!1}},getCardsByNames:{action:nsPrefixDotNotation+"CardCanvasController.getCardsByNames",config:{escape:!1,buffer:!1}},getStaticResourcesUrl:{action:nsPrefixDotNotation+"CardCanvasController.getStaticResourcesUrl",config:{escape:!1,buffer:!1}},doGenericInvoke:{action:nsPrefixDotNotation+"CardCanvasController.doGenericInvoke",config:{escape:!1,buffer:!1}},getAllObjects:{action:nsPrefixDotNotation+"CardCanvasController.getAllObjects",config:{escape:!1,buffer:!1}},getFieldsForObject:{action:nsPrefixDotNotation+"CardCanvasController.getFieldsForObject",config:{escape:!1,buffer:!1}},getActiveTemplateNames:{action:nsPrefixDotNotation+"CardCanvasController.getActiveTemplateNames",config:{escape:!1,buffer:!1}},getTemplate:{action:nsPrefixDotNotation+"CardCanvasController.getTemplate",config:{escape:!1,buffer:!1}},getCustomLabelValue:{action:nsPrefixDotNotation+"CardCanvasController.getCustomLabelValue",config:{escape:!1,buffer:!1}},getCustomLabels:{action:nsPrefixDotNotation+"CardCanvasController.getCustomLabels",config:{escape:!1,buffer:!1}},doNamedCredentialCallout:{action:nsPrefixDotNotation+"CardCanvasController.doNamedCredentialCallout",config:{escape:!1,buffer:!1}},getCustomSettings:{action:nsPrefixDotNotation+"CardCanvasController.getCustomSettings",config:{escape:!1,buffer:!1}}};"undefined"!=typeof Visualforce&&remoteActionsProvider.setRemoteActions(remoteActions||{})}]).filter("picker",function($interpolate){return function(){var result;return"currency"===arguments[1]||"datetime"===arguments[1]||"percentage"===arguments[1]||"phone"===arguments[1]?(result=$interpolate("{{value | "+arguments[1]+"}}"))({value:arguments[0]}):"date"===arguments[1]?(result=$interpolate("{{value | "+arguments[1]+':"shortDate"}}'))({value:arguments[0]}):arguments[0]}}).filter("getter",function(){return function(expr,scope){var result="";try{var field=arguments[1].name||arguments[1].Name;result=_.get(expr,field)}catch(e){}return result}}).filter("resolveCustomField",["$rootScope",function($rootScope){return function(input,fieldName,path){var resolvedName=fieldName;return"__c"===resolvedName.slice(-3)&&(resolvedName=resolvedName.slice(0,-3)),_.isEmpty($rootScope.nsPrefix)?resolvedName+="__c":resolvedName=$rootScope.nsPrefix+resolvedName+"__c",path&&path.length>0?_.get(input[resolvedName],path):input[resolvedName]}}]).filter("customLabel",["$rootScope","remoteActions","$timeout","$log",function($rootScope,remoteActions,$timeout,$log){function getCustomLabel(labelName){if($rootScope.customLabels[labelName])return $rootScope.customLabels[labelName];$rootScope.customLabels[labelName]=labelName;try{getLabelsPromise(labelName).then(function(allLabels){$log.debug("customLabel getAllLabelsPromise ",JSON.parse(allLabels));var labelResult=JSON.parse(allLabels);$rootScope.customLabels.language=labelResult.language,$rootScope.customLabels[labelName]=labelResult[labelName],$log.debug("custom labels ",$rootScope.customLabels)},function(error){$log.debug("customLabel getAllLabelsPromise retrieval error: ",error)})}catch(e){$log.error(e)}}function getLabelsPromise(labelName){if($rootScope.promiseCache=$rootScope.promiseCache?$rootScope.promiseCache:{},$rootScope.promiseCache["getCustomLabelValue::"+labelName])return $rootScope.promiseCache["getCustomLabelValue::"+labelName];var labelPromise=remoteActions.getCustomLabels([labelName],null);return $rootScope.promiseCache["getCustomLabelValue::"+labelName]=labelPromise,labelPromise}return $log=$log.getInstance("CardFramework: filter: customLabel"),$rootScope.customLabels=$rootScope.customLabels?$rootScope.customLabels:{},getCustomLabel.$stateful=!0,getCustomLabel}]).filter("moment",["$rootScope",function($rootScope){return function(dateString,format){var localTime=moment.tz(dateString,$rootScope.userTimeZone);return moment(localTime).format(format)}}]).filter("datetime",["$filter",function($filter){return function(input){return input&&""!==input?$filter("moment")(input,"lll"):""}}]).filter("percentage",["$filter",function($filter){return function(input,decimals){return"undefined"===input||null==input||""===input?"":$filter("number")(input,decimals)+"%"}}]).filter("uniqueValues",function(){return function(items,filterOn,includeEmpty){if(filterOn===!1)return items;if((filterOn||angular.isUndefined(filterOn))&&angular.isArray(items)){var newItems=[],extractValueToCompare=function(item){return angular.isObject(item)&&angular.isString(filterOn)?item[filterOn]:item};angular.forEach(items,function(item){for(var isDuplicate=!1,i=0;i<newItems.length;i++)if(angular.equals(extractValueToCompare(newItems[i]),extractValueToCompare(item))){isDuplicate=!0;break}isDuplicate||newItems.push(item)}),items=newItems}return includeEmpty&&items.push(includeEmpty),items}}).filter("phone",function(){return function(phone){if(!phone)return"";var value=phone.toString().trim().replace(/^\+/,"");if(value.match(/[^0-9]/))return phone;var country,city,number;switch(value.length){case 10:country=1,city=value.slice(0,3),number=value.slice(3);break;case 11:country=value[0],city=value.slice(1,4),number=value.slice(4);break;case 12:country=value.slice(0,3),city=value.slice(3,5),number=value.slice(5);break;default:return phone}return 1===country&&(country=""),number=number.slice(0,3)+"-"+number.slice(3),(country+" ("+city+") "+number).trim()}}).filter("currency",["$rootScope","ISO_CURRENCY_INFO",function($rootScope,ISO_CURRENCY_INFO){return function(amt){if("undefined"===amt||null==amt||""===amt)return"";var formattedAmount,isoCurrencyCode=$rootScope.userCurrency||"USD",isoCurrencySymbol=ISO_CURRENCY_INFO[isoCurrencyCode].text,isoCurrencyFormatString=ISO_CURRENCY_INFO[isoCurrencyCode].format,numOfDecimalPlaces=2,decimalSeparator=".",thousandsSeparator=",";return isoCurrencyFormatString?(/\.##$/m.test(isoCurrencyFormatString)||/,##$/m.test(isoCurrencyFormatString)?numOfDecimalPlaces=2:(/\.###$/m.test(isoCurrencyFormatString)||/,###$/m.test(isoCurrencyFormatString))&&(numOfDecimalPlaces=3),/\.##$/m.test(isoCurrencyFormatString)||/\.###$/m.test(isoCurrencyFormatString)?decimalSeparator=".":(/,##$/m.test(isoCurrencyFormatString)||/,###$/m.test(isoCurrencyFormatString))&&(decimalSeparator=","),"#.###"!==isoCurrencyFormatString&&"#,###"!==isoCurrencyFormatString&&"# ###"!==isoCurrencyFormatString&&(/^#\.###/m.test(isoCurrencyFormatString)?thousandsSeparator=".":/^#,###/m.test(isoCurrencyFormatString)?thousandsSeparator=",":/^# ###/m.test(isoCurrencyFormatString)&&(thousandsSeparator=" ")),formattedAmount=accounting.formatMoney(amt,isoCurrencySymbol,numOfDecimalPlaces,thousandsSeparator,decimalSeparator)):isoCurrencySymbol+amt}}]).constant("ISO_CURRENCY_INFO",{ALL:{text:"Lek",uniDec:"76, 101, 107",uniHex:"4c, 65, 6b"},AFN:{text:"؋",uniDec:"1547",uniHex:"60b"},ARS:{text:"$",uniDec:"36",uniHex:"24",format:"#.###,##"},AWG:{text:"ƒ",uniDec:"402",uniHex:"192",format:"#,###.##"},AUD:{text:"$",uniDec:"36",uniHex:"24",format:"# ###.##"},AZN:{text:"ман",uniDec:"1084, 1072, 1085",uniHex:"43c, 430, 43d"},BSD:{text:"$",uniDec:"36",uniHex:"24",format:"#,###.##"},BBD:{text:"$",uniDec:"36",uniHex:"24"},BYR:{text:"p.",uniDec:"112, 46",uniHex:"70, 2e"},BZD:{text:"BZ$",uniDec:"66, 90, 36",uniHex:"42, 5a, 24",format:"#,###.##"},BMD:{text:"$",uniDec:"36",uniHex:"24",format:"#,###.##"},BOB:{text:"$b",uniDec:"36, 98",uniHex:"24, 62",format:"#,###.##"},BAM:{text:"KM",uniDec:"75, 77",uniHex:"4b, 4d",format:"#,###.##"},BWP:{text:"P",uniDec:"80",uniHex:"50",format:"#,###.##"},BGN:{text:"лв",uniDec:"1083, 1074",uniHex:"43b, 432"},BRL:{text:"R$",uniDec:"82, 36",uniHex:"52, 24",format:"#.###,##"},BND:{text:"$",uniDec:"36",uniHex:"24",format:"#,###.##"},KHR:{text:"៛",uniDec:"6107",uniHex:"17db"},CAD:{text:"$",uniDec:"36",uniHex:"24",format:"#,###.##"},KYD:{text:"$",uniDec:"36",uniHex:"24",format:"#,###.##"},CLP:{text:"$",uniDec:"36",uniHex:"24",format:"#.###"},CNY:{text:"¥",uniDec:"165",uniHex:"a5",format:"#,###.##"},COP:{text:"$",uniDec:"36",uniHex:"24",format:"#.###,##"},CRC:{text:"₡",uniDec:"8353",uniHex:"20a1",format:"#.###,##"},HRK:{text:"kn",uniDec:"107, 110",uniHex:"6b, 6e",format:"#.###,##"},CUP:{text:"₱",uniDec:"8369",uniHex:"20b1",format:"#,###.##"},CZK:{text:"Kč",uniDec:"75, 269",uniHex:"4b, 10d",format:"#.###,##"},DKK:{text:"kr",uniDec:"107, 114",uniHex:"6b, 72",format:"#.###,##"},DOP:{text:"RD$",uniDec:"82, 68, 36",uniHex:"52, 44, 24",format:"#,###.##"},XCD:{text:"$",uniDec:"36",uniHex:"24",format:"#,###.##"},EGP:{text:"£",uniDec:"163",uniHex:"a3",format:"#,###.##"},SVC:{text:"$",uniDec:"36",uniHex:"24",format:"#,###.##"},EEK:{text:"kr",uniDec:"107, 114",uniHex:"6b, 72",format:"#,###.##"},EUR:{text:"€",uniDec:"8364",uniHex:"20ac",format:"#,###.##"},FKP:{text:"£",uniDec:"163",uniHex:"a3"},FJD:{text:"$",uniDec:"36",uniHex:"24"},GHC:{text:"¢",uniDec:"162",uniHex:"a2",format:"#,###.##"},GIP:{text:"£",uniDec:"163",uniHex:"a3",format:"#,###.##"},GTQ:{text:"Q",uniDec:"81",uniHex:"51",format:"#,###.##"},GGP:{text:"£",uniDec:"163",uniHex:"a3"},GYD:{text:"$",uniDec:"36",uniHex:"24"},HNL:{text:"L",uniDec:"76",uniHex:"4c",format:"#,###.##"},HKD:{text:"$",uniDec:"36",uniHex:"24",format:"#,###.##"},HUF:{text:"Ft",uniDec:"70, 116",uniHex:"46, 74",format:"#.###"},ISK:{text:"kr",uniDec:"107, 114",uniHex:"6b, 72",format:"#.###"},INR:{text:"",uniDec:"",uniHex:"",format:"#,##,###.##"},IDR:{text:"Rp",uniDec:"82, 112",uniHex:"52, 70",format:"#.###,##"},IRR:{text:"ریال",uniDec:"65020",uniHex:"fdfc",format:"#,###.##"},IMP:{text:"£",uniDec:"163",uniHex:"a3"},ILS:{text:"₪",uniDec:"8362",uniHex:"20aa",format:"#,###.##"},JMD:{text:"J$",uniDec:"74, 36",uniHex:"4a, 24",format:"#,###.##"},JPY:{text:"¥",uniDec:"165",uniHex:"a5",format:"#,###"},JEP:{text:"£",uniDec:"163",uniHex:"a3"},KZT:{text:"лв",uniDec:"1083, 1074",uniHex:"43b, 432"},KPW:{text:"₩",uniDec:"8361",uniHex:"20a9"},KRW:{text:"₩",uniDec:"8361",uniHex:"20a9",format:"#,###"},KGS:{text:"лв",uniDec:"1083, 1074",uniHex:"43b, 432"},LAK:{text:"₭",uniDec:"8365",uniHex:"20ad"},LVL:{text:"Ls",uniDec:"76, 115",uniHex:"4c, 73",format:"#,###.##"},LBP:{text:"£",uniDec:"163",uniHex:"a3",format:"# ###"},LRD:{text:"$",uniDec:"36",uniHex:"24"},LTL:{text:"Lt",uniDec:"76, 116",uniHex:"4c, 74",format:"# ###,##"},MKD:{text:"ден",uniDec:"1076, 1077, 1085",uniHex:"434, 435, 43d",format:"#,###.##"},MYR:{text:"RM",uniDec:"82, 77",uniHex:"52, 4d",format:"#,###.##"},MUR:{text:"Rs",uniDec:"8360",uniHex:"20a8",format:"#,###"},MXN:{text:"$",uniDec:"36",uniHex:"24",format:"#,###.##"},MNT:{text:"₮",uniDec:"8366",uniHex:"20ae"},MZN:{text:"MT",uniDec:"77, 84",uniHex:"4d, 54"},NAD:{text:"$",uniDec:"36",uniHex:"24"},NPR:{text:"Rs",uniDec:"8360",uniHex:"20a8",format:"#,###.##"},ANG:{text:"ƒ",uniDec:"402",uniHex:"192",format:"#.###,##"},NZD:{text:"$",uniDec:"36",uniHex:"24",format:"#,###.##"},NIO:{text:"C$",uniDec:"67, 36",uniHex:"43, 24"},NGN:{text:"₦",uniDec:"8358",uniHex:"20a6"},NOK:{text:"kr",uniDec:"107, 114",uniHex:"6b, 72",format:"#.###,##"},OMR:{text:"ریال",uniDec:"65020",uniHex:"fdfc",format:"#,###.###"},PKR:{text:"Rs",uniDec:"8360",uniHex:"20a8",format:"#,###.##"},PAB:{text:"B/.",uniDec:"66, 47, 46",uniHex:"42, 2f, 2e"},PYG:{text:"Gs",uniDec:"71, 115",uniHex:"47, 73"},PEN:{text:"S/.",uniDec:"83, 47, 46",uniHex:"53, 2f, 2e",format:"#,###.##"},PHP:{text:"₱",uniDec:"8369",uniHex:"20b1",format:"#,###.##"},PLN:{text:"zł",uniDec:"122, 322",uniHex:"7a, 142",format:"# ###,##"},QAR:{text:"ریال",uniDec:"65020",uniHex:"fdfc"},RON:{text:"lei",uniDec:"108, 101, 105",uniHex:"6c, 65, 69",format:"#.###,##"},RUB:{text:"руб",uniDec:"1088, 1091, 1073",uniHex:"440, 443, 431",format:"#.###,##"},SHP:{text:"£",uniDec:"163",uniHex:"a3"},SAR:{text:"ریال",uniDec:"65020",uniHex:"fdfc",format:"#,###.##"},RSD:{text:"Дин.",uniDec:"1044, 1080, 1085, 46",uniHex:"414, 438, 43d, 2e"},SCR:{text:"Rs",uniDec:"8360",uniHex:"20a8"},SGD:{text:"$",uniDec:"36",uniHex:"24",format:"#,###.##"},SBD:{text:"$",uniDec:"36",uniHex:"24"},SOS:{text:"S",uniDec:"83",uniHex:"53"},ZAR:{text:"R",uniDec:"82",uniHex:"52",format:"# ###.##"},LKR:{text:"Rs",uniDec:"8360",uniHex:"20a8"},SEK:{text:"kr",uniDec:"107, 114",uniHex:"6b, 72",format:"# ###,##"},CHF:{text:"CHF",uniDec:"67, 72, 70",uniHex:"43, 48, 46",format:"#'###.##"},SRD:{text:"$",uniDec:"36",uniHex:"24"},SYP:{text:"£",uniDec:"163",uniHex:"a3"},TWD:{text:"NT$",uniDec:"78, 84, 36",uniHex:"4e, 54, 24"},THB:{text:"฿",uniDec:"3647",uniHex:"e3f",format:"#,###.##"},TTD:{text:"TT$",uniDec:"84, 84, 36",uniHex:"54, 54, 24"},TRY:{text:"",uniDec:"",uniHex:"",format:"#,###.##"},TRL:{text:"₤",uniDec:"8356",uniHex:"20a4"},TVD:{text:"$",uniDec:"36",uniHex:"24"},UAH:{text:"₴",uniDec:"8372",uniHex:"20b4",format:"# ###,##"},GBP:{text:"£",uniDec:"163",uniHex:"a3",format:"#,###.##"},USD:{text:"$",uniDec:"36",uniHex:"24",format:"#,###.##"},UYU:{text:"$U",uniDec:"36, 85",uniHex:"24, 55",format:"#.###,##"},UZS:{text:"лв",uniDec:"1083, 1074",uniHex:"43b, 432"},VEF:{text:"Bs",uniDec:"66, 115",uniHex:"42, 73",format:"#.###,##"},VND:{text:"₫",uniDec:"8363",uniHex:"20ab",format:"#.###"},YER:{text:"ریال",uniDec:"65020",uniHex:"fdfc"},ZWD:{text:"Z$",uniDec:"90, 36",uniHex:"5a, 24",format:"# ###.##"}}).constant("API_VERSION","v34.0").value("timeStampInSeconds",Math.floor((new Date).getTime()/1e3)).service("debugService",function(){this.valueOfNameSpacePrefix=function(nsPrefix){return""==nsPrefix?"no namespace required for this org":nsPrefix},this.displayNameSpacePrefix=function(functionName,nsPrefix){this.valueOfNameSpacePrefix(nsPrefix)}}).service("networkService",function(){}).factory("PromiseQueueFactory",function($q,$log){function getNextTask(){var currentTask=tasks.shift();return currentTask}function cacheTask(cachePromise,promiseKey){return $log.debug("caching "+promiseKey+" - ",cachePromise),promiseKey=promiseKey||Date.now(),promiseCache({key:promiseKey,promise:cachePromise,ttl:ttl,expireOnFailure:function(request){return 200!==request.status}})}function executeTask(){if($log.debug("calling execute task"),!alreadyExecuting){var task=(new Error,getNextTask());if(task){alreadyExecuting=!0;var key=task.key;task.task.success||task.task,task.task.fail,task.task.notify;try{task.task().then(function(data){return $log.debug("task key "+key+" completed"),task.done=!0,alreadyExecuting=!1,executeTask(),data},function(error){$log.debug("task key "+key+" error ",error),task.done=!0,task.error=!0,alreadyExecuting=!1,executeTask()})}catch(e){$log.error("error executing task ",task,e),task.done=!0,task.error=!0,alreadyExecuting=!1,executeTask()}}else alreadyExecuting=!1}}function wrapPromiseFunction(p,args){return function(){var deferred=$q.defer();return args=Array.isArray(args)?args:[args],p.apply(null,args).then(function(data){deferred.resolve("resolved wrapped function")},function(){deferred.reject("bad wrapped function")}),deferred.promise}}$log=$log.getInstance("CardFramework: PromiseQueueFactory");var ttl=5e3,tasks=[],alreadyExecuting=!1;return{cacheFunction:function(cachePromise,promiseKey){return cacheTask(cachePromise,promiseKey)},executeTasks:function(){count=0,executeTask()},getTasks:function(){return tasks},addTask:function(p,args,key){var task={task:wrapPromiseFunction(p,args)};task.key=key||Date.now(),tasks.push(task),$log.debug("added task ",task)},nextTask:function(){return tasks[0]},clearTasks:function(){tasks=[]},wrapFunction:function(p,args){return wrapPromiseFunction(p,args)}}}).factory("nameSpaceService",function($q){return{getNameSpacePrefix:function(){return $q(function(resolve){resolve(fileNsPrefix())})}}}).factory("userProfileService",function(remoteActions,$log){return $log=$log.getInstance("CardFramework: userProfileService"),{getUserProfile:function(){return remoteActions.getUserProfile().then(function(userp){return userp},function(error){$log.debug("getUserProfile retrieval error: "+error)})}}}).factory("metaDataService",function($log){return $log=$log.getInstance("CardFramework: metaDataService"),{getGlobalDescribeTk:function(forcetkClient){return forcetkClient.describeGlobal(function(result){var sObjects=result.sobjects;return sObjects},function(error){$log.error("getGlobalDescribe retrieval error: "+error)})},getDescribeTk:function(sObjectType,forcetkClient){return forcetkClient.describe(sObjectType,function(result){var sObjectTypeFields=result.fields;return sObjectTypeFields},function(error){console.info("getDescribe retrieval error: "+error)})}}}).factory("actionService",function($q,remoteActions,force,nameSpaceService,debugService,$log){var QueryString=function(){for(var queryString={},query=window.location.search.substring(1),vars=query.split("&"),i=0;i<vars.length;i++){var pair=vars[i].split("=");if("undefined"==typeof queryString[pair[0]])queryString[pair[0]]=decodeURIComponent(pair[1]);else if("string"==typeof queryString[pair[0]]){var arr=[queryString[pair[0]],decodeURIComponent(pair[1])];queryString[pair[0]]=arr}else queryString[pair[0]].push(decodeURIComponent(pair[1]))}return queryString}();return{actionListObject:"",getActionsInfo:function(){var deferred=$q.defer();if(!this.actionListObject){var that=this;"undefined"!=typeof remoteActions&&null!==remoteActions&&remoteActions.getActionsInfo?remoteActions.getActionsInfo().then(function(actions){deferred.resolve(actions)},function(error){$log.debug("getActionsInfo retrieval error:"+error),that.actionListObject=void 0,deferred.reject(new Error("getActionsInfo retrieval error: "+error))}):nameSpaceService.getNameSpacePrefix().then(function(nsPrefix){debugService.displayNameSpacePrefix("getActionsInfo",nsPrefix);var actionsQuery="SELECT Id, Name, "+nsPrefix+"ApplicableTypes__c, "+nsPrefix+"ApplicableUserProfiles__c, "+nsPrefix+"DisplayLabel__c, "+nsPrefix+"DisplayOn__c, "+nsPrefix+"Filter__c, "+nsPrefix+"LinkType__c, "+nsPrefix+"OpenUrlMode__c, "+nsPrefix+"Url__c, "+nsPrefix+"UrlParameters__c, "+nsPrefix+"VlocityIcon__c FROM "+nsPrefix+"VlocityAction__c WHERE Name != 'ConsoleCards' AND "+nsPrefix+"IsActive__c = true";return force.query(actionsQuery).then(function(data){var actions=data.records;deferred.resolve(actions)},function(error){$log.error("getActionsInfo retrieval error: "+error),that.actionListObject=void 0,deferred.reject(new Error("getActionsInfo retrieval error: "+error))})}),this.actionListObject=deferred.promise}return this.actionListObject},getActions:function(objType,soRecord,displayOn,linkType,forcetkClient,$log){var ctxId=soRecord?soRecord.Id:QueryString.Id;return ctxId=ctxId?ctxId:null,"undefined"!=typeof remoteActions&&null!=remoteActions&&remoteActions.getActions?remoteActions.getActions(objType,ctxId,displayOn,linkType).then(function(actionsJSON){var actions=JSON.parse(actionsJSON);return actions},function(error){$log.debug("getActionsTk retrieval error: "+error)}):nameSpaceService.getNameSpacePrefix().then(function(nsPrefix){debugService.displayNameSpacePrefix("getActionsTk",nsPrefix);var apexRestUrlNameSpacePrefix=""===nsPrefix?"":"/"+nsPrefix.replace("__","");return force.apexrest({path:apexRestUrlNameSpacePrefix+"/v1/action/action",params:{objType:objType,sFilterContextId:ctxId,sDisplayOn:displayOn,sLinkType:linkType}},function(actions){return actions},function(error){$log.debug("getActionsTk retrieval error: "+error),$log.debug(error)},"GET")})}}}).factory("dataService",function(remoteActions,force,nameSpaceService,debugService,pageService,$interpolate,$log){return $log=$log.getInstance("CardFramework: dataService"),{getRecords:function(queryStr){var cardQuery=queryStr?queryStr:"SELECT Id, Name, AccountNumber, Industry, AccountSource, LastModifiedDate, (SELECT Id,Name,Title,FirstName,LastName,Phone,Department FROM Contacts) FROM Account LIMIT 2";return"undefined"!=typeof remoteActions&&null!=remoteActions&&remoteActions.getDataViaDynamicSoql?remoteActions.getDataViaDynamicSoql(queryStr).then(function(records){var records=JSON.parse(records);return $log.debug("getRecords completed: ",records),records},function(error){return $log.error("getRecords retrieval error: "+error),error}):force.query(cardQuery).then(function(data){var records=data.records;return records},function(error){return $log.error("getRecords retrieval error: "+error),error})},getDataRaptorBundle:function(bundle,ctxId,forcetkClient){return nameSpaceService.getNameSpacePrefix().then(function(nsPrefix){debugService.displayNameSpacePrefix("getDataRaptorBundle",nsPrefix);var apexRestUrlNameSpacePrefix=""==nsPrefix?"":"/"+nsPrefix.replace("__","");return forcetkClient.apexrest(apexRestUrlNameSpacePrefix+"/v2/DataRaptor/"+bundle+"/"+ctxId,function(result){return result},function(error){$log.debug("getDataRaptorBundle retrieval error: "+error)},"GET")})},doGenericInvoke:function(className,methodName,inputMap,optionsMap){return $log.debug("calling dataService: doGenericInvoke()",className,methodName,inputMap,optionsMap),nameSpaceService.getNameSpacePrefix().then(function(nsPrefix){if("undefined"!=typeof remoteActions&&null!=remoteActions&&remoteActions.doGenericInvoke)return inputMap=inputMap?inputMap:{},optionsMap=optionsMap?optionsMap:{},remoteActions.doGenericInvoke(className,methodName,inputMap,optionsMap).then(function(records){var records=JSON.parse(records);return $log.debug("doGenericInvoke completed: ",records),records},function(error){return $log.debug("doGenericInvoke error: "+error),error})})},doNamedCredentialCallout:function(requestMap){return $log.debug("calling dataService: doNamedCredentialCallout()",requestMap),nameSpaceService.getNameSpacePrefix().then(function(nsPrefix){if("undefined"!=typeof remoteActions&&null!=remoteActions&&remoteActions.doNamedCredentialCallout)return remoteActions.doNamedCredentialCallout(requestMap).then(function(records){try{var records=JSON.parse(records);return $log.debug("doNamedCredentialCallout completed: ",records),records}catch(e){$log.debug("error parsing response ",e)}return records},function(error){return $log.debug("doNamedCredentialCallout error: ",error),error})})},getAccountById:function(id){return"undefined"!=typeof remoteActions&&null!=remoteActions&&remoteActions.getAccountById?remoteActions.getAccountById(id).then(function(account){var account=JSON.parse(account);return $log.debug("getAccountById completed: ",account),account},function(error){$log.debug("getAccountById retrieval error: "+error)}):force.retrieve("Account",id,"Id, Name, BillingAddress, Phone, PhotoURL, Website").then(function(account){return account},function(error){$log.debug("getAccountById retrieval error: "+error)})},getCustomSettings:function(customSettingsName){return"undefined"!=typeof remoteActions&&null!=remoteActions&&remoteActions.getCustomSettings?remoteActions.getCustomSettings(customSettingsName).then(function(result){var customSettings=JSON.parse(result);return $log.debug("getCustomSettings completed: ",customSettings),customSettings},function(error){$log.debug("getCustomSettings retrieval error: ",error)}):void $log.debug("getCustomSettings - REST not supported yet.")},getConsoleCardsAction:function(objType,filterContextId,forcetkClient){return"undefined"!=typeof remoteActions&&null!=remoteActions&&remoteActions.getConsoleCardsAction?remoteActions.getConsoleCardsAction(objType,filterContextId).then(function(consoleCardsActionJSON){var consoleCardsAction=JSON.parse(consoleCardsActionJSON);return $log.debug("getConsoleCardsAction: ",consoleCardsAction),consoleCardsAction},function(error){$log.debug("getConsoleCardsAction retrieval error: "+error)}):nameSpaceService.getNameSpacePrefix().then(function(nsPrefix){debugService.displayNameSpacePrefix("getConsoleCardsAction",nsPrefix);var apexRestUrlBase="/v1/action?objType="+objType+"&sFilterContextId="+filterContextId+"&sDisplayOn=Web%20Client&sLinkType=Other",apexRestUrlNameSpacePrefix=""==nsPrefix?"":"/"+nsPrefix.replace("__",""),apexRestUrl=apexRestUrlNameSpacePrefix+apexRestUrlBase;return forcetkClient.apexrest(apexRestUrl,function(actions){for(var consoleCardsAction,i=0;i<actions.length;i++)if(null!=actions[i].name&&"ConsoleCards"==actions[i].name){consoleCardsAction=actions[i];break}return consoleCardsAction},function(error){$log.error("getConsoleCardsAction retrieval error: "+error)},"GET")})},getApexRest:function(endpoint,method,payload,forcetkClient){return nameSpaceService.getNameSpacePrefix().then(function(nsPrefix){debugService.displayNameSpacePrefix("getApexRest",nsPrefix);var apexRestUrlBase=endpoint,apexRestUrl=apexRestUrlBase;return"undefined"!=typeof Visualforce?forcetkClient.apexrest(apexRestUrl,function(result){return result},function(error){console.info("getApexRest error: ",error)},method,payload):force.request({path:apexRestUrlBase,method:method,data:payload}).then(function(result){return result},function(error){$log.error("getApexRest retrieval error: "+error)})})}}}).factory("relationshipMgmtService",function(force,nameSpaceService,debugService,$log){return $log=$log.getInstance("CardFramework: relationshipMgmtService"),{getStoriesTk:function(objectId,forcetkClient,numberOfDays,storyType){return nameSpaceService.getNameSpacePrefix().then(function(nsPrefix){debugService.displayNameSpacePrefix("getStoriesTk",nsPrefix);var apexRestUrlNameSpacePrefix=""==nsPrefix?"":"/"+nsPrefix.replace("__",""),apexRestUrl=apexRestUrlNameSpacePrefix+"/v1/story/"+objectId,extraRequestParameters="",days=parseInt(numberOfDays);isNaN(days);return null===numberOfDays||isNaN(parseInt(numberOfDays))||(extraRequestParameters="?days="+numberOfDays),null!==storyType&&(extraRequestParameters+=extraRequestParameters?"&storyType="+storyType:"?storyType="+storyType),apexRestUrl+=extraRequestParameters,forcetkClient.apexrest(apexRestUrl,function(result){return result},function(error){console.info("getStoriesTk retrieval error: "+error)},"GET")})},getAttributesTk:function(objectId,forcetkClient){return nameSpaceService.getNameSpacePrefix().then(function(nsPrefix){debugService.displayNameSpacePrefix("getAttributesTk",nsPrefix);var apexRestUrlNameSpacePrefix=""===nsPrefix?"":"/"+nsPrefix.replace("__","");return forcetkClient.apexrest(apexRestUrlNameSpacePrefix+"/v1/segment/assignments/"+objectId,function(result){return result},function(error){console.info("getAttributesTk retrieval error: "+error)},"GET")})}}}).factory("dataSourceService",function(dataService,$interpolate,$localizable,$q,$http,$log){function handleQuery(datasource,scope,deferred,errorContainer){query=datasource.value.query,query=$interpolate(query)(scope),dataService.getRecords(query).then(function(records){$log.debug("datasourceService ",records),records&&"exception"===records.type&&(errorContainer.sourceType=datasource.type,errorContainer.data=records,errorContainer.message=records.message,deferred.reject(errorContainer)),deferred.resolve(records)},function(err){deferred.reject(err)})}function handleDataRaptor(datasource,scope,deferred,errorContainer,forcetkClient){var cardBundle=datasource.value.bundle,cardCtxId=$interpolate("{{"+datasource.value.ctxId+"}}")(scope);dataService.getDataRaptorBundle(cardBundle,cardCtxId,forcetkClient).then(function(records){$log.debug(records);var errorMsg,hasError=!0;for(var prop in records)if(records.hasOwnProperty(prop)){hasError=!1;break}hasError?(errorMsg=$localizable("CardDesignerDataSourceDataRaptorError","Something is wrong with either the interface name or the context id is invalid"),errorContainer.sourceType=datasource.type,errorContainer.data=records,errorContainer.message=errorMsg,deferred.reject(errorContainer)):deferred.resolve(records)},function(err){errorContainer.sourceType=datasource.type,errorContainer.data=err,errorContainer.message="DataRaptor Error",deferred.reject(errorContainer)})}function handleApexRemote(datasource,scope,deferred,errorContainer){var className=datasource.value.remoteNSPrefix?datasource.value.remoteNSPrefix+"."+datasource.value.remoteClass:datasource.value.remoteClass,methodName=datasource.value.remoteMethod,inputMap=datasource.value.inputMap?$interpolate(JSON.stringify(datasource.value.inputMap))(scope):null;datasource.value.optionsMap=datasource.value.optionsMap||{},datasource.value.optionsMap.vlcClass=datasource.value.optionsMap.vlcClass||className;var optionsMap=datasource.value.optionsMap?$interpolate(JSON.stringify(datasource.value.optionsMap))(scope):null;if(!className||!methodName)return errorContainer.sourceType=datasource.type,
errorContainer.data=null,errorContainer.message="Cannot execute Apex Remote without Class or Method names",deferred.reject(errorContainer),deferred.promise;var apexClassInfo=className.split("."),apexClass={NamespacePrefix:apexClassInfo.length>1?apexClassInfo[0]:null,Name:apexClassInfo.length>1?apexClassInfo[1]:apexClassInfo[0]};if(apexClass.Name&&methodName){dataService.doGenericInvoke(className,methodName,inputMap,optionsMap).then(function(records){$log.debug(records);var errorMsg,errorCode,hasError=!1;return!records.status&"exception"===records.type&&(errorContainer.sourceType=datasource.type,errorContainer.data=records,errorContainer.message=records.message,deferred.reject(errorContainer)),records.error&&"OK"!=records.error&&(errorCode=records.errorCode,errorMsg=records.error,hasError=!0,errorCode&&("INVOKECLASS-404"==errorCode?errorMsg=$localizable("CardDesignerDataSourceApexRemoteClassNotFoundError","Class not found"):"INVOKEMETHOD-405"==errorCode?errorMsg=$localizable("CardDesignerDataSourceApexRemoteMethodNotFoundError","Method not found"):"INVOKE_500"==errorCode&&(errorMsg=records.error)),errorContainer.sourceType=datasource.type,errorContainer.data=records,errorContainer.message=errorMsg,deferred.reject(errorContainer)),deferred.resolve(records),records})}}function handleApexRest(datasource,scope,deferred,errorContainer,forcetkClient){var payload,endpoint=$interpolate(datasource.value.endpoint)(scope),method=datasource.value.methodType;payload=scope?datasource.value.body&&"GET"!=datasource.value.methodType?$interpolate(datasource.value.body)(scope):null:datasource.value.body&&"GET"!=datasource.value.methodType?datasource.value.body:null,console.info(endpoint),dataService.getApexRest(endpoint,method,payload,forcetkClient).then(function(records){$log.debug(records),deferred.resolve(records)},function(error){console.error(error);var errorMsg="";try{errorMsg=JSON.parse(error.responseText),$log.debug(errorMsg[0]),errorMsg=errorMsg[0].message}catch(e){errorMsg=error.status+" - "+error.statusText}errorContainer.sourceType=datasource.type,errorContainer.data=error,errorContainer.message=errorMsg,deferred.reject(errorContainer)})}function handleRest(datasource,scope,deferred,errorContainer){var payload=datasource.value.body&&"GET"!=datasource.value.methodType?JSON.parse($interpolate(datasource.value.body)(scope)):null,headers=datasource.value.header?angular.copy(datasource.value.header):[],headerObj={};angular.forEach(headers,function(header){header.val=header.val?$interpolate(header.val)(scope):header.val,header.name&&header.val&&(headerObj[header.name]=header.val)});var req={method:datasource.value.methodType,url:datasource.value.endpoint?$interpolate(datasource.value.endpoint)(scope):"",headers:headerObj,data:payload};if($log.debug(req),"NamedCredential"===datasource.value.subType){var inputMap={namedCredential:datasource.value.namedCredential,headers:headers.length>0?headerObj:null,restMethod:datasource.value.methodType,restPath:datasource.value.endpoint?$interpolate(datasource.value.endpoint)(scope):"",data:payload};dataService.doNamedCredentialCallout(JSON.stringify(inputMap)).then(function(records){$log.debug(records),deferred.resolve(records)},function(error){console.error(error);var errorMsg="";try{errorMsg=JSON.parse(error.responseText),$log.debug(errorMsg[0]),errorMsg=errorMsg[0].message}catch(e){errorMsg=error.status+" - "+error.statusText}errorContainer.sourceType=datasource.type,errorContainer.data=error,errorContainer.message=errorMsg,deferred.reject(errorContainer)})}else $http(req).then(function(records){$log.debug(records),deferred.resolve(records)},function(error){console.info("rest error",error),0===error.status&&(error.status=404,error.statusText=$localizable("CardDesignerDataSourceRestResultCrossDomainError","No Access-Control-Allow-Origin header is present on the requested resource. The response had HTTP status code 404")),errorContainer.sourceType=datasource.type,errorContainer.data=error,errorContainer.message=error.statusText,deferred.reject(errorContainer)})}function handleCustom(datasource,deferred){try{var records=JSON.parse(datasource.value.body);$log.debug(records),records?deferred.resolve(records):(errorContainer.sourceType=datasource.type,errorContainer.data=null,errorContainer.message=$localizable("CardDesignerValidJSON","Please enter valid JSON"),deferred.reject(errorContainer))}catch(e){$log.debug(e)}}return{getData:function(datasource,scope,forcetkClient){$log.debug("calling the datasourceService ",datasource);var deferred=$q.defer(),errorContainer={};if(!datasource.value&&datasource.type)return errorContainer.sourceType=datasource.type,errorContainer.data=null,errorContainer.message="You need to finish setting up the datasource",deferred.reject(errorContainer),deferred.promise;switch(datasource.type){case"Query":handleQuery(datasource,scope,deferred,errorContainer);break;case"DataRaptor":handleDataRaptor(datasource,scope,deferred,errorContainer,forcetkClient);break;case"ApexRemote":handleApexRemote(datasource,scope,deferred,errorContainer);break;case"ApexRest":handleApexRest(datasource,scope,deferred,errorContainer,forcetkClient);break;case"Dual":"undefined"!=typeof Visualforce?handleApexRemote(datasource,scope,deferred,errorContainer):handleApexRest(datasource,scope,deferred,errorContainer,forcetkClient);break;case"REST":handleRest(datasource,scope,deferred,errorContainer);break;case"Custom":handleCustom(datasource,deferred);break;case"Inherit":deferred.resolve("inherit success");break;default:$log.debug("bad data source"),errorContainer.sourceType=datasource.type,errorContainer.data=null,errorContainer.message="bad data source",deferred.reject(errorContainer)}return deferred.promise},selectResultNode:function(datasource,records,nodeVar){return records="Dual"===datasource.type?"undefined"!=typeof Visualforce?datasource.value.apexRemoteResultVar?_.get(records,datasource.value.apexRemoteResultVar):records:datasource.value.apexRestResultVar?_.get(records,datasource.value.apexRestResultVar):records:nodeVar?_.get(records,nodeVar):datasource.value&&datasource.value.resultVar?_.get(records,datasource.value.resultVar):records}}}),require("./modules/cardframework/factory/configService.js"),require("./modules/cardframework/factory/cardIconFactory.js"),require("./modules/cardframework/factory/actionLauncher.js"),require("./modules/cardframework/factory/performAction.js"),require("./modules/cardframework/factory/parseUri.js"),require("./modules/cardframework/directives/hotkeysLayoutNavigation.js"),require("./modules/cardframework/directives/flyout.js"),require("./modules/cardframework/directives/vlocInput.js"),require("./modules/cardframework/directives/vlocCard.js"),require("./modules/cardframework/directives/vlocCardIcon.js"),require("./modules/cardframework/directives/vlocCmp.js"),require("./modules/cardframework/directives/vlocLayout.js"),require("./modules/cardframework/templates/templates.js");
},{"./VlocTemplates.js":2,"./modules/cardframework/directives/flyout.js":3,"./modules/cardframework/directives/hotkeysLayoutNavigation.js":4,"./modules/cardframework/directives/vlocCard.js":5,"./modules/cardframework/directives/vlocCardIcon.js":6,"./modules/cardframework/directives/vlocCmp.js":7,"./modules/cardframework/directives/vlocInput.js":8,"./modules/cardframework/directives/vlocLayout.js":9,"./modules/cardframework/factory/actionLauncher.js":10,"./modules/cardframework/factory/cardIconFactory.js":11,"./modules/cardframework/factory/configService.js":12,"./modules/cardframework/factory/parseUri.js":13,"./modules/cardframework/factory/performAction.js":14,"./modules/cardframework/templates/templates.js":15}],2:[function(require,module,exports){
"use strict";var templates={};angular.module("vlocTemplates",["vlocity"]).value("vlocTemplateInternalCache",{names:null,pending:{initialize:[]},resolved:{}}).config(["remoteActionsProvider",function(remoteActionsProvider){remoteActionsProvider.setRemoteActions({getActiveTemplateNames:{action:fileNsPrefixDot()+"CardCanvasController.getActiveTemplateNames"},getTemplate:{action:fileNsPrefixDot()+"CardCanvasController.getTemplate"}})}]).config(["$compileProvider",function($compileProvider){$compileProvider.debugInfoEnabled(!1)}]).run(function(remoteActions,vlocTemplateInternalCache,force){"undefined"!=typeof Visualforce&&remoteActions.getActiveTemplateNames().then(function(templatesNames){vlocTemplateInternalCache.names=templatesNames,vlocTemplateInternalCache.pending.initialize&&vlocTemplateInternalCache.pending.initialize.forEach(function(callback){callback()}),delete vlocTemplateInternalCache.pending.initialize})}).config(["$provide",function($provide){function unescapeHTML(html){return angular.isString(html)?(escape.innerHTML=html,escape.value):html}function insertCSS(templateName,cssContent){var head=document.getElementsByTagName("head")[0],cssId=templateName+".css",existingStyle=document.getElementById(cssId);if(existingStyle)for(;existingStyle.firstChild;)existingStyle.removeChild(existingStyle.firstChild);else existingStyle=document.createElement("style"),existingStyle.setAttribute("type","text/css"),existingStyle.setAttribute("id",cssId),head.appendChild(existingStyle);existingStyle.styleSheet?existingStyle.styleSheet.cssText=cssContent:existingStyle.appendChild(document.createTextNode(cssContent))}function registerController(templateName,controllerJS){console.log("loading js file for ",templateName,controllerJS);var tryHeader="(function () { try { ",catchBlock="} catch(e) { console.log('error in "+templateName+".js ',e); } })();\n//# sourceURL=vlocity/dynamictemplate/"+templateName+".js\n",head=document.getElementsByTagName("head")[0],jsId=templateName+".js",existingScript=document.getElementById(jsId);existingScript||(existingScript=document.createElement("script"),existingScript.setAttribute("type","text/javascript"),existingScript.setAttribute("id",jsId),head.appendChild(existingScript),existingScript.appendChild(document.createTextNode(tryHeader+controllerJS+catchBlock)))}var escape=document.createElement("textarea");$provide.decorator("$templateCache",["$delegate","vlocTemplateInternalCache",function($delegate,vlocTemplateInternalCache){var original=$delegate.get;return $delegate.get=function(name){if(vlocTemplateInternalCache.resolved[name])return insertCSS(name,vlocTemplateInternalCache.resolved[name][fileNsPrefix()+"CSS__c"]),vlocTemplateInternalCache.resolved[name][fileNsPrefix()+"CustomJavascript__c"]&&registerController(name,vlocTemplateInternalCache.resolved[name][fileNsPrefix()+"CustomJavascript__c"]),vlocTemplateInternalCache.resolved[name][fileNsPrefix()+"HTML__c"];if(vlocTemplateInternalCache.names&&vlocTemplateInternalCache.names.indexOf(name)>-1)try{console.warn(name+" was expected to be in cache but not found - has it been downloaded via $templateRequest yet? Will trigger request in backgroud")}catch(e){}return original.apply($delegate,Array.prototype.slice.call(arguments))},$delegate}]),$provide.decorator("$templateRequest",["$delegate","vlocTemplateInternalCache","remoteActions","$q","force","pageService",function($delegate,vlocTemplateInternalCache,remoteActions,$q,force,pageService){var original=$delegate,useCache=!pageService.params.useCache||"true"===pageService.params.useCache;return function vlocTemplateRequest(name){var originalArgs=Array.prototype.slice.call(arguments),me=this;if(!vlocTemplateInternalCache.names)return $q(function(resolve){vlocTemplateInternalCache.pending.initialize.push(function(){resolve(vlocTemplateRequest.apply(me,originalArgs))})});if(vlocTemplateInternalCache.names.indexOf(name)>-1&&!vlocTemplateInternalCache.resolved[name]){if(vlocTemplateInternalCache.pending[name])return vlocTemplateInternalCache.pending[name];var templateDefinitionJsonFromCache,templateDefinitionStringFromCache=sessionStorage.getItem("template::"+name);if(useCache&&templateDefinitionStringFromCache)return templateDefinitionJsonFromCache=JSON.parse(templateDefinitionStringFromCache),vlocTemplateInternalCache.resolved[name]=templateDefinitionJsonFromCache,original.apply(me,originalArgs);if("undefined"!=typeof Visualforce)var promise=remoteActions.getTemplate(name).then(function(template){return delete vlocTemplateInternalCache.pending[name],template[fileNsPrefix()+"HTML__c"]=unescapeHTML(template[fileNsPrefix()+"HTML__c"]),template[fileNsPrefix()+"Sass__c"]=unescapeHTML(template[fileNsPrefix()+"Sass__c"]),template[fileNsPrefix()+"CSS__c"]=unescapeHTML(template[fileNsPrefix()+"CSS__c"]),sessionStorage.setItem("template::"+name,JSON.stringify(template)),vlocTemplateInternalCache.resolved[name]=template,original.apply(me,originalArgs)});else var query="SELECT Id,  Name, "+fileNsPrefix()+"HTML__c, "+fileNsPrefix()+"Type__c, "+fileNsPrefix()+"CSS__c, "+fileNsPrefix()+"CustomJavascript__c FROM "+fileNsPrefix()+"VlocityUITemplate__c WHERE Name = '"+name+"' AND "+fileNsPrefix()+"Active__c = true",promise=force.query(query).then(function(data){var template=data.records[0];return delete vlocTemplateInternalCache.pending[name],template[fileNsPrefix()+"HTML__c"]=unescapeHTML(template[fileNsPrefix()+"HTML__c"]),template[fileNsPrefix()+"Sass__c"]=unescapeHTML(template[fileNsPrefix()+"Sass__c"]),template[fileNsPrefix()+"CSS__c"]=unescapeHTML(template[fileNsPrefix()+"CSS__c"]),sessionStorage.setItem("template::"+name,JSON.stringify(template)),vlocTemplateInternalCache.resolved[name]=template,original.apply(me,originalArgs)},function(err){console.error(err)});return vlocTemplateInternalCache.pending[name]=promise,promise}return original.apply(me,originalArgs)}}])}]).service("pageService",function(){this.params=function(){var query,vars,queryString={};if(query="undefined"!=typeof Visualforce?window.location.search.substring(1):window.location.hash.split("?")[1]){vars=query.split("&");for(var i=0;i<vars.length;i++){var pair=vars[i].split("=");if("undefined"==typeof queryString[pair[0]])queryString[pair[0]]=decodeURIComponent(pair[1]);else if("string"==typeof queryString[pair[0]]){var arr=[queryString[pair[0]],decodeURIComponent(pair[1])];queryString[pair[0]]=arr}else queryString[pair[0]].push(decodeURIComponent(pair[1]))}}return queryString}()});
},{}],3:[function(require,module,exports){
angular.module("CardFramework").directive("flyout",function(){"use strict";return{transclude:!0,replace:!0,template:'<section class="console-flyout active flyout"><div class="flyout-arrow" style="left:{{flyoutArrowLeftPos}}px"></div><div class="flyout-close" ng-click="hideFlyout()"><i class="icon icon-v-close"></i></div><div class="card-info"><ng-transclude></ng-transclude></div></section>'}}).directive("embeddedFlyout",function(){"use strict";return{transclude:!0,replace:!0,template:'<section class="console-flyout active flyout"><div class="card-info" ng-transclude></div></section>'}}).service("$vlocFlyout",function($rootScope,$sldsPopover,$compile,$log){function performFlyout($scope,layoutName,data,cardIndex,parentObj){var isCardSelected=!1;return(isCardSelected=$(".cards-container").find("[data-card="+cardIndex+"]").hasClass("selected"))?(hideFlyout(),!1):(console.log("calling performFlyout in layout "+layoutName),$scope.newLayoutName=layoutName,$scope.childData=data,$scope.parentObj=parentObj,console.log($scope.layout),void openFlyout($scope,cardIndex,parentObj))}function openFlyout($scope,cardIndex,parentObj){var currentElementPos,flyoutEl,index,cardsContainer=$(".cards-container"),selectedCard=cardsContainer.find("[data-card="+cardIndex+']:not(".flyout [data-card]")'),sectionCardsLength=cardsContainer.find('[data-card]:not(".flyout [data-card]")').length;if(hideFlyout(),$rootScope.selected=cardIndex.split("-")[1],0!==selectedCard.length)if(selectedCard.data("popover-flyout"))openSldsFlyouts.push($sldsPopover(selectedCard,{template:'<vloc-layout layout-name="{{newLayoutName}}" records="childData" parent="parentObj" class="slds-m-around--small" style="max-width: calc(100% - 3rem);"></vloc-layout>',show:!0,nubbinDirection:"top",container:cardsContainer,trigger:"manual",scope:$scope}));else if(selectedCard.data("embed-flyout")&&":parent"!==selectedCard.data("embed-flyout"))flyoutEl=$compile('<embedded-flyout><vloc-layout layout-name="{{newLayoutName}}" records="childData" parent="parentObj"></vloc-layout></embedded-flyout>')($scope),$(selectedCard.data("embed-flyout"),selectedCard).append(flyoutEl);else for(currentElementPos=selectedCard.length>0?selectedCard.position().top:void 0,$scope.flyoutArrowLeftPos=parseInt((selectedCard.position().left+selectedCard.position().left+selectedCard.outerWidth())/2,10),flyoutEl=$compile('<flyout><vloc-layout layout-name="{{newLayoutName}}" records="childData" parent="parentObj"></vloc-layout></flyout>')($scope),index=Number(cardIndex.split("-")[1]);index<=sectionCardsLength;){var nextElem=cardsContainer.find("[data-card=card-"+(index+1)+']:not(".flyout [data-card]")'),nextElemTopPos=nextElem.length>0?nextElem.position().top:"empty";if(nextElemTopPos-currentElementPos>10||"empty"===nextElemTopPos){var target=cardsContainer.find("[data-card=card-"+index+']:not(".flyout [data-card]")');":parent"==selectedCard.data("embed-flyout")?$(flyoutEl).insertAfter($(target).parent()):$(flyoutEl).insertAfter(target),positionFlyoutToViewport(selectedCard);break}index+=1}}function positionFlyoutToViewport(card){var cardTop,flyoutTop,flyoutHeight,windowHeight,newScrollTop,scrollSpeed=100,marginForFlyout=15,jqFlyout=$(".flyout");if(card&&card.length>0&&jqFlyout.length>0)try{cardTop=card.offset().top,flyoutTop=jqFlyout.offset().top,windowHeight=$window.innerHeight,flyoutHeight=jqFlyout.outerHeight(),newScrollTop=flyoutHeight+card.outerHeight()+marginForFlyout<=windowHeight?cardTop-5:flyoutHeight<windowHeight?flyoutTop-(windowHeight-flyoutHeight):flyoutTop,$("html, body").animate({scrollTop:newScrollTop},scrollSpeed)}catch(e){$log.log("Error occured while scrolling the flyout to viewport",e.message)}else $log.log("Failed to scroll the Flyout to viewport - Card/Flyout element not available")}function hideFlyout(e){$rootScope.selected="none",$rootScope.$broadcast("vlocity.layouts.closeflyouts"),$(".cards-container .flyout").addClass("hide").remove()}var openSldsFlyouts=[];return $rootScope.hideFlyout=hideFlyout,$rootScope.$on("vlocity.layouts.closeflyouts",function(event,data){openSldsFlyouts.forEach(function(flyout){flyout.hide()})}),$rootScope.$on("$includeContentLoaded",function(event,data){openSldsFlyouts.forEach(function(popover){popover.$applyPlacement()})}),{performFlyout:performFlyout,openFlyout:openFlyout,hideFlyout:hideFlyout}});
},{}],4:[function(require,module,exports){
angular.module("CardFramework").directive("hotkeysLayoutNavigation",["hotkeys","$window","$document","$log","$rootScope",function(hotkeys,$window,$document,$log,$rootScope){"use strict";return{restrict:"A",link:function(scope,element,attr){function getDirection(type){var directionObj={right:{directionType:"horizontal",order:1},left:{directionType:"horizontal",order:-1},up:{directionType:"vertical",order:-1},down:{directionType:"vertical",order:1}};return type?directionObj[type.toLowerCase()]:""}function customEventAction(action){action&&"deselect"===action.toLowerCase()?deSelect():navigate(action)}function navigate(direction){var jqCardElements,prevSelectedItemIndex,nextSelectionItemIndex,directionType,order,iterativeIndex,prevSelectedItem=element.find("[hotkey-layout-card].hotkey-highlight").not(".flyout");if(directionType=getDirection(direction).directionType,order=getDirection(direction).order,document.hasFocus()||$window.focus(),0===prevSelectedItem.length){if("horizontal"===directionType)return element.find("[hotkey-layout-card]:eq(0)").addClass("hotkey-highlight"),void scrollToViewport(element.find("[hotkey-layout-card]:eq(0)"));if("vertical"===directionType)return}if(jqCardElements=element.find('[hotkey-layout-card]:not(".flyout [hotkey-layout-card]")'),prevSelectedItemIndex=jqCardElements.index(prevSelectedItem),"vertical"===directionType&&jqCardElements.hasClass("selected"))return void navigateCardActions(order);if(iterativeIndex="vertical"===directionType?itemsPerRow():1,nextSelectionItemIndex=prevSelectedItemIndex+order*iterativeIndex,jqCardElements.eq(nextSelectionItemIndex).length>0){if(order===-1&&nextSelectionItemIndex<0)return;prevSelectedItem.removeClass("hotkey-highlight"),jqCardElements.eq(nextSelectionItemIndex).addClass("hotkey-highlight"),scrollToViewport(jqCardElements.eq(nextSelectionItemIndex))}}function itemsPerRow(){var offset,itemsPerRowCount=0;return element.find("[hotkey-layout-card]").each(function(){var $this=$(this);if(offset){if($this.offset().top>offset+10)return!1}else offset=$this.offset().top;itemsPerRowCount+=1}),itemsPerRowCount}function navigateCardActions(order){var actionList,focusedElementIndex,flyoutActionList,selectedCard=element.find("[hotkey-layout-card].selected").not(".flyout"),focusElement=selectedCard.find(".focus[hotkey-card-action]");0===focusElement.length&&(focusElement=element.find(".flyout .focus[hotkey-card-action]")),0===focusElement.length?selectedCard.find("[hotkey-card-action]:eq(0)").addClass("focus").focus():(actionList=element.find("[hotkey-layout-card].selected [hotkey-card-action]"),flyoutActionList=element.find(".flyout [hotkey-card-action]"),actionList=actionList.add(flyoutActionList),focusedElementIndex=actionList.index(focusElement),focusElement.removeClass("focus").blur(),actionList.eq(focusedElementIndex+order).addClass("focus").focus())}function scrollToViewport(element){element.offset()&&element.offset().top+100<$window.scrollY+$window.innerHeight&&($("html, body").animate({scrollTop:element.offset().top-100},"fast"),$log.info("Selected card is not visible in view port, scrolling to to make it visible"))}function deSelect(){var selectedItem=element.find("[hotkey-layout-card].hotkey-highlight"),isFlyoutOpen=element.find(".cards-container .flyout").length>0,selectedCard=element.find("[hotkey-layout-card].selected");return isFlyoutOpen||selectedCard.length>0?($rootScope.$broadcast("hotkeys.navigation.deselectCard"),void selectedCard.find(":focus").removeClass("focus").blur()):(selectedItem.removeClass("hotkey-highlight"),void $log.info("De-select active card, Esc key pressed"))}function selectCard(){var highlightedIndex,selectedCard=element.find("[hotkey-layout-card].selected");element.find("[hotkey-layout-card].hotkey-highlight").not(".selected").length>0&&(highlightedIndex=element.find('[hotkey-layout-card]:not(".flyout [hotkey-layout-card]")').index(element.find("[hotkey-layout-card].hotkey-highlight")),$rootScope.$broadcast("hotkeys.navigation.selectcard",highlightedIndex)),0===element.find("[hotkey-layout-card].hotkey-highlight.selected").length&&selectedCard.length>0&&selectedCard.find(":focus").removeClass("focus").blur()}var customEventsArray=["customShortcut.vlocity.cards.right","customShortcut.vlocity.cards.left","customShortcut.vlocity.cards.up","customShortcut.vlocity.cards.down","customShortcut.vlocity.cards.deselect"];scope.$on("hotkeys.navigation.dehighlight",function(event){}),hotkeys.bindTo(scope).add({combo:["right","alt+right"],description:'Card selection traverses from left to right. Alternately use "ALT + RIGHT"',callback:function(event,hotkey){event.preventDefault(),event.stopPropagation(),navigate("right")}}).add({combo:["left","alt+left"],description:'Card selection traverses from right to left. Alternately use "ALT + LEFT"',callback:function(){event.preventDefault(),event.stopPropagation(),navigate("left")}}).add({combo:"up",description:"Card selection traverses upwards",callback:function(event,hotkey){event.preventDefault(),event.stopPropagation(),navigate("up")}}).add({combo:"down",description:"Card selection traverses downwards",callback:function(event,hotkey){event.preventDefault(),event.stopPropagation(),navigate("down")}}).add({combo:"enter",description:"Opens flyout for active card",callback:function(){selectCard()}}).add({combo:"esc",description:"Deselect the card",callback:function(){event.preventDefault(),event.stopPropagation(),deSelect()}});try{"undefined"!=typeof sforce&&sforce&&sforce.console&&sforce.console.isInConsole()&&sforce.console.getFocusedSubtabId(function(subtab){var subtabId=subtab&&subtab.id;customEventsArray.forEach(function(element,index){!function(subtabId){function customNavigate(result){sforce.console.getFocusedSubtabId(function(focusedSubtab){subtabId===focusedSubtab.id&&actionTypeCache&&customEventAction(actionTypeCache)})}var actionTypeCache,actionType=element.split(".");actionTypeCache=actionType[actionType.length-1],sforce.console.addEventListener(element,customNavigate),scope.$on("$destroy",function(){sforce.console.removeEventListener(element,customNavigate)})}(subtabId)})})}catch(e){$log.error("Error occured in salesforce custom keyboard events in cards",e.message)}}}}]);
},{}],5:[function(require,module,exports){
angular.module("CardFramework").directive("vlocCard",function($compile){"use strict";return{restrict:"EA",require:"?ngModel",replace:!0,scope:{customtemplate:"@",ctrl:"@",name:"@?",data:"=?",obj:"=?",loaded:"=?",useExistingElementType:"@?",records:"=?",sessionId:"@",cardIndex:"@index"},compile:function(element,attributes){return{post:function(scope,element,attributes,controller,transcludeFn){scope.init()}}},controller:["$scope","$rootScope","$element","$q","$controller","$attrs","timeStampInSeconds","actionService","dataService","$interpolate","pageService","networkService","configService","performAction","$filter","$localizable","$http","dataSourceService","$vlocFlyout","$log",function($scope,$rootScope,$element,$q,$controller,$attrs,timeStampInSeconds,actionService,dataService,$interpolate,pageService,networkService,configService,performAction,$filter,$localizable,$http,dataSourceService,$vlocFlyout,$log){function cleanUpElement(){childScope.forEach(function(scope){scope.$destroy()}),innerElement.forEach(function(element){element.remove()}),childScope=[],innerElement=[],$element.html("")}$log=$log.getInstance("CardFramework: vloc-card"),$scope.sObjects=null,$scope.finishedLoading=!1,$scope.nsPrefix=$rootScope.nsPrefix,$scope.params=pageService.params,$scope.attrs=$attrs,$scope.loggedUser=$rootScope.loggedUser?$rootScope.loggedUser:null,$scope.inactiveError={header:$localizable("CardFrameworkInactiveErrorHeader","Error"),errorMsg:$localizable("CardFrameworkInactiveErrorMsg","There is no active instance of"),associationNameLabel:$localizable("CardFrameworkInactiveAssociationNameLabel","associated with"),associationTypeLabel:$localizable("CardFrameworkInactiveAssociationTypeLabel","of type"),associationType:$localizable("CardFrameworkInactiveAssociationTypeCard","card"),contactAdminMsg:$localizable("CardFrameworkContactAdminMsg","Please contact your Salesforce Admin")};var innerElement=[],childScope=[];$log.debug("------------------------------------------------------card loaded: ",$scope.data),$scope.$on("hotkeys.navigation.selectcard",function(event,highlightIndex){Number($scope.cardIndex)===highlightIndex&&($log.debug("hot key Enter"),$scope.performFlyout("card-"+highlightIndex))}),$scope.deleteObj=function(){$log.debug("deleting card"),delete $scope.obj,delete $scope.data.obj,delete $scope.pickedState,$scope.data.status="non-existent",$log.debug("element to be deleted ",$element),cleanUpElement(),pickState()},$scope.toggleEditMode=function(){$log.debug("toggling editmode "+$scope.data.editMode),$scope.editWatch=$scope.editWatch||function(){$log.debug("watch not set up")},$scope.data.status=$scope.data.editMode?"edit-mode":"active","edit-mode"===$scope.data.status?$scope.editWatch():$scope.editWatch=$scope.$watch("obj",function(newVal,oldVal){var sameObj=angular.equals(oldVal,newVal);if(!sameObj&&newVal)if($log.debug("changed from ",oldVal,newVal),$scope.data.validationError=[],$scope.data.validationSuccess=null,$scope.evaluateSessionVars(),$scope.pickedState.editCustomCallback){$log.debug($scope.pickedState.editCustomCallback);try{eval($scope.pickedState.editCustomCallback+"($scope.obj)")}catch(e){$scope.data.validationError=[],$scope.data.validationError.push({message:"error using custom callback for editing: "+e}),$log.debug("error using custom callback for editing: ",e)}}else $scope.obj.attributes&&$scope.obj.attributes.type&&configService.saveObject($scope.obj,$scope.obj.attributes.type).then(function(result){$log.debug(result),$scope.data.validationSuccess="Successfully Saved Record!",result&&($scope.obj=result)},function(errors){$log.debug(errors),$scope.data.validationError=[],angular.forEach(errors,function(err){$scope.data.validationError.push(err)}),$log.debug("setting validation error ",$scope.data.validationError)})},!0),pickState()},$scope.init=function(){if($log.debug("initializing card"),$scope.ctrl){$log.debug("injecting "+$scope.ctrl);var injectedScopeModel=$scope.$new();$controller($scope.ctrl,{$scope:injectedScopeModel}),$scope.importedScope=injectedScopeModel,$log.debug("importedScope ",$scope.importedScope)}!$scope.data&&$scope.name?($log.debug("lonely card"),loadCardDefinition().then(loadRecords).then(startCard)):$scope.data.dataSource&&!$scope.obj?($log.debug("card needs data"),loadRecords().then(startCard)):($log.debug("load card template ",$scope.data),startCard())};var loadCardDefinition=function(){return $log.debug("loadCardDefinition"),configService.getCardByName($scope.name,$scope.useCache).then(function(card){return card?($log.debug("fetched card ",card),$scope.data=card,void($scope.data.status=null)):void $log.error("configService.getCardByName: card undefined: "+$scope.name)})},loadRecords=function(){$log.debug("loadRecords"),$log.debug($scope.data.dataSource);var deferred=$q.defer();return $scope.data.dataSource?$scope.data.dataSource.type?dataSourceService.getData($scope.data.dataSource,$scope,$rootScope.forcetkClient).then(function(records){$log.debug("result from datasourceService ",records),$scope.payload=records,$scope.records=dataSourceService.selectResultNode($scope.data.dataSource,records),deferred.resolve("Success")},function(err){$log.debug("data error ",err)}):$scope.records?(angular.forEach($scope.data.sessionVars,function(sessionVar){try{$scope.session[sessionVar.name]=$interpolate("{{"+sessionVar.val+"}}")($scope)}catch(e){$log.debug("could not set ",sessionVar,e)}}),$scope.records=dataSourceService.selectResultNode($scope.data.dataSource,$scope.records),deferred.resolve("Success")):($log.debug("card dataSource not implemented"),deferred.reject("Failure")):$scope.records?deferred.resolve("Success"):($log.debug("card dataSource not implemented"),deferred.reject("Failure")),deferred.promise};$scope.reloadCard=function(){delete $scope.obj,delete $scope.data.obj,delete $scope.pickedState,cleanUpElement(),$scope.payload=null,$scope.records=[],$scope.data.status=null,loadRecords().then(startCard)};var startCard=function(){$log.debug("startCard",$scope.data),$scope.obj=$scope.obj?$scope.obj:$scope.data.obj,$scope.obj?pickState():($log.debug("calling pickRecords"),$scope.pickRecords($scope.records))},pickState=function(){$scope.data.states?(angular.forEach($scope.data.states,function(state){if("string"==typeof state.filter){if(eval(state.filter))return $scope.pickedState=state,$scope.pickedState.sObjectType=$scope.pickedState.sObjectType?$scope.pickedState.sObjectType:"All",$scope.data.fields=state.fields,$scope.data.flyout=state.flyout,$scope.data.definedActions=state.definedActions,$scope.obj?$scope.data.actionCtxId=state.actionCtxId?_.get($scope.obj,state.actionCtxId):eval("$scope.obj.Id"):$scope.data.actionCtxId=$scope.params.id||$scope.params.Id,$scope.templateUrl=state.templateUrl,$scope.getActions(),cleanUpElement(),$scope.loadTemplate(),$scope.pickedState}else if($scope.checkFilter($scope.obj,state.filter))return $scope.pickedState=state,$scope.pickedState.sObjectType=$scope.pickedState.sObjectType?$scope.pickedState.sObjectType:"All",$scope.data.fields=state.fields,$scope.data.flyout=state.flyout,$scope.data.definedActions=state.definedActions,$scope.obj?$scope.data.actionCtxId=state.actionCtxId?_.get($scope.obj,state.actionCtxId):eval("$scope.obj.Id"):$scope.data.actionCtxId=$scope.params.id||$scope.params.Id,$scope.templateUrl=state.templateUrl,$scope.getActions(),cleanUpElement(),$scope.loadTemplate(),$scope.pickedState}),$scope.pickedState||($log.debug("didnt find a state ",$scope.pickedState),$element.remove(),$scope.loadTemplate())):$scope.loadTemplate()};$scope.pickRecords=function(records){$log.debug("records for card:",records),records&&!$scope.sObjects&&($scope.sObjects=[],records=angular.isArray(records)?records:[records],$log.debug("picking records from "+records.length+" choices"),angular.forEach(records,function(rec,i){$scope.checkFilter(rec,$scope.data.filter)&&(rec.$$vlocityCardIndex=i,$scope.sObjects.push(rec))}),$log.debug("sObjects after pickRecords",$scope.sObjects),$scope.finishedLoading=!0,$scope.sObjects.length>0?($scope.obj=$scope.sObjects[0],$scope.data.cardIndex=$scope.obj.$$vlocityCardIndex,delete $scope.obj.$$vlocityCardIndex,$scope.sObjects.splice(0,1),"active"!=$scope.data.status&&($scope.data.status="active"),$scope.data.obj||(angular.forEach($scope.sObjects,function(sObject,i){var cardData=angular.copy($scope.data);cardData.obj=sObject,cardData.cardIndex=sObject.$$vlocityCardIndex,delete sObject.$$vlocityCardIndex,$log.debug("calling "+$scope.data.layoutName+".addCard ---- "+cardData.cardIndex),$scope.$emit($scope.data.layoutName+".addCard",cardData)}),$scope.sObjects=[])):$scope.data.status="non-existent",$scope.data.states?pickState():($scope.getActions(),cleanUpElement(),$scope.loadTemplate()))},$element.on("$destroy",function(){$scope.$destroy()}),$scope.deleteCard=function(){$log.debug("deleting card"),$scope.$destroy()},$scope.changeStatus=function(status){status?$scope.data.status=status:$scope.data.status="active"===$scope.data.status?"disabled":"active"},$scope.getObjFieldValue=function(obj,objFieldName){if("undefined"!=typeof obj&&null!=obj){if(objFieldName.indexOf("__c")>-1){var nsPrefixedObjFieldName=$rootScope.nsPrefix+objFieldName,nsPrefixedObjFieldValue=obj[nsPrefixedObjFieldName];return nsPrefixedObjFieldValue}var objFieldValue=obj[objFieldName];return objFieldValue}return null},$scope.getChildrenDataForForeignKey=function(childrenForeignKey){if($scope.childrenDataList=[],"undefined"!=typeof $scope.obj&&null!=$scope.obj)if(childrenForeignKey.indexOf("__r")>-1){var nsPrefixedChildrenForeignKey=$rootScope.nsPrefix+childrenForeignKey;null!=$scope.obj[nsPrefixedChildrenForeignKey]&&($scope.childrenDataList=$scope.obj[nsPrefixedChildrenForeignKey].records)}else null!=$scope.obj[childrenForeignKey]&&($scope.childrenDataList=$scope.obj[childrenForeignKey].records)},$scope.performAction=function(action,actionConfig){return performAction(action,actionConfig,$scope.obj,$scope.data,$scope.data.filter,$scope.pickedState)},$scope.performFlyout=function(cardIndex){var childData=[],layoutName,parentObj;if($log.debug($scope.data.flyout),$scope.data.flyout&&$scope.data.flyout.layout){$log.debug($rootScope.layouts);try{childData=eval($scope.data.flyout.data)}catch(e){$log.debug("Evaluating card Flyout Data Object failed. ",e.message)}layoutName=$scope.data.flyout.layout,parentObj=$scope.data,$vlocFlyout.performFlyout($scope,layoutName,childData,cardIndex,parentObj)}else $rootScope.selectCard(cardIndex),$log.debug("flyout not enabled for this card")},$scope.isSelected=function(cardIndex){return!!cardIndex&&$rootScope.selected===cardIndex},$scope.getActions=function(){var evalActions=$scope.data.definedActions&&$scope.data.definedActions.actions,actionList=evalActions?evalActions:[],allActions=$rootScope.allActions||[],orgActions={},device=window.outerWidth>768?"Web Client":"Mobile";$scope.data.actions&&$scope.data.actions.length>0||($scope.data.actions=[],angular.forEach(allActions,function(action){var actionObj={};actionObj=angular.copy(action),actionObj.displayName=actionObj[$rootScope.nsPrefix+"DisplayLabel__c"],actionObj.vlocityIcon=actionObj[$rootScope.nsPrefix+"VlocityIcon__c"],orgActions[actionObj.Name]=actionObj}),angular.forEach(actionList,function(defAction){var displayOnFlag;if("Vlocity Action"===defAction.type&&orgActions[defAction.id]){displayOnFlag=orgActions[defAction.id][$rootScope.nsPrefix+"DisplayOn__c"];var objType="All";try{objType=$scope.pickedState.sObjectType,!$scope.obj||$scope.pickedState.sObjectType&&"All"!==$scope.pickedState.sObjectType||(objType=$scope.obj.attributes?$scope.obj.attributes.type:"All")}catch(e){objType="All"}var objMatchesFlag="All"===objType||orgActions[defAction.id][$rootScope.nsPrefix+"ApplicableTypes__c"].indexOf(objType)>-1||orgActions[defAction.id][$rootScope.nsPrefix+"ApplicableTypes__c"].indexOf("All")>-1;displayOnFlag&&("All"===displayOnFlag||displayOnFlag===device)&&objMatchesFlag&&$scope.data.actions.push(orgActions[defAction.id])}else"Custom"===defAction.type?$scope.data.actions.push(defAction):$log.debug("action not setup properly ",defAction)}))},$scope.getActions_old=function(objType,soRecord){return $q(function(resolve,reject){if($log.debug("calling getActions"),$scope.data.actions&&$scope.data.actions.length>0&&($log.debug("actions already in place"),resolve("Success")),$scope.data.actions=[],$scope.data.definedActions&&$scope.data.definedActions.actions&&$scope.data.definedActions.actions.length>0||$scope.data.filter.attributes){try{objType=$scope.pickedState.sObjectType,$scope.obj&&(objType=$scope.obj.attributes?$scope.obj.attributes.type:$scope.pickedState.sObjectType,soRecord=$scope.data.actionCtxId?{Id:$scope.data.actionCtxId}:{Id:$scope.obj.Id})}catch(e){objType="All",soRecord=$scope.obj}var evalActions=$scope.data.definedActions&&$scope.data.definedActions.actions,actionList=evalActions?evalActions:[];soRecord&&delete soRecord.$$hashKey;var device=window.outerWidth>768?"Web Client":"Mobile";actionService.getActions(objType,soRecord,device,null,$rootScope.forcetkClient).then(function(actions){if($log.debug("actions: ",actions),actionList.length>0){var orgActions={};angular.forEach(actions,function(action){orgActions[action.name]=action}),angular.forEach(actionList,function(defAction){"Vlocity Action"===defAction.type&&orgActions[defAction.id]?$scope.data.actions.push(orgActions[defAction.id]):"Custom"===defAction.type?$scope.data.actions.push(defAction):$log.debug("action not setup properly ",defAction)})}else $scope.data.actions=actions;resolve("Success")})}else $log.debug("remote actions are not available or actions are not defined for this"),reject("Failure")})},$scope.evaluateSessionVars=function(){angular.forEach($scope.data.sessionVars,function(sessionVar){try{$scope.session[sessionVar.name]=$interpolate("{{"+sessionVar.val+"}}")($scope),$log.debug("session var ",$scope.session,sessionVar)}catch(e){$log.debug("could not set ",sessionVar,e)}}),$log.debug("session variables",$scope.session),delete $scope.payload},$scope.loadTemplate=function(){var templateUrl;templateUrl=$scope.customtemplate?$scope.customtemplate:$scope.templateUrl,$log.debug("loading card template: "+$scope.data.title+"-"+templateUrl),$log.debug(templateUrl,$scope.data.status),$scope.evaluateSessionVars(),configService.checkIfTemplateIsActive(templateUrl).then(function(ok){if(null==$attrs.useExistingElementType){var newScope=$scope.$new(!1);childScope.push(newScope);var compiledDom=$compile("<ng-include src=\"'"+templateUrl+"'\" include-replace></ng-include>")(newScope);innerElement.push(compiledDom),$element.append(compiledDom)}},function(error){if(!$scope.params.previewMode){$scope.inactiveError.inactiveEntityNameLabel=$localizable("CardFrameworkInactiveTemplateNameLabel","Template Name"),$scope.inactiveError.inactiveEntityName=templateUrl,$scope.inactiveError.associationFlag=!0,$scope.inactiveError.associationName=$scope.data.title;var newScope=$scope.$new(!1);childScope.push(newScope);var compiledDom=$compile("<ng-include src=\"'displayInactiveError.tpl.html'\"></ng-include>")(newScope);innerElement.push(compiledDom),$element.append(compiledDom)}}),$log.debug("card index "+$scope.attrs.index),$scope.data.obj=$scope.obj},$scope.checkFilter=function(sObject,filterObject){var success=!0;if(!sObject)return success=!1;if(0==Object.keys(sObject).length)return success=!1;for(var field in filterObject){if("object"==typeof sObject[field])success=$scope.checkFilter(sObject[field],filterObject[field]);else{var objField=_.get(sObject,field);success=filterObject[field]==objField}if(!success)return success}return success}}],template:function(tElement,tAttrs){return null!=tAttrs.useExistingElementType?"<"+tElement[0].localName+' ng-include="customtemplate ? customtemplate : templateUrl"></'+tElement[0].localName+">":"<div></div>"}}}).directive("includeReplace",function(){"use strict";return{require:"ngInclude",restrict:"A",compile:function(tElement,tAttrs){return tElement.replaceWith(tElement.children()),{post:angular.noop}}}});
},{}],6:[function(require,module,exports){
angular.module("CardFramework").directive("vlocCardIcon",function(){"use strict";function getViewBoxForSprite(sprite){switch(sprite){case"custom":case"standard":return"0 0 100 100";case"docType":return"0 0 56 64";default:return"0 0 52 52"}}return{restrict:"EA",replace:!0,scope:{data:"=?",obj:"=?",icon:"=?",sprite:"=?",size:"=?",extraClasses:"=?"},controller:["$scope","$rootScope","$element","$attrs","cardIconFactory","$sldsGetAssetPrefix","svgIconFactory",function($scope,$rootScope,$element,$attrs,cardIconFactory,$sldsGetAssetPrefix,svgIconFactory){$scope.size||($scope.size="medium"),$scope.extraClasses||($scope.extraClasses="");var iconConfig=null,dereg=$scope.$watch(function(){return svgIconFactory($scope.sprite,$scope.icon)},function(svgtext){""!==svgtext&&($element.get(0).setAttribute("viewBox",getViewBoxForSprite($scope.sprite)),$element.children("use").replaceWith(svgtext),dereg())});if(!$scope.sprite&&!$scope.icon){if($scope.data&&$scope.data.sprite&&$scope.data.icon)iconConfig={sprite:$scope.data.sprite,icon:$scope.data.icon};else if($scope.data&&$scope.data.vlocityIcon&&!/^icon-/.test($scope.data.vlocityIcon)){var parts=$scope.data.vlocityIcon.split("-");$scope.data.sprite=parts[0],$scope.data.icon=parts[1],iconConfig={sprite:$scope.data.sprite,icon:$scope.data.icon}}else if($scope.obj&&$scope.obj.attributes&&$scope.obj.attributes.type&&(!$scope.data||!$scope.data.vlocityIcon)){var cleanType=$scope.obj.attributes.type.replace("__c","");iconConfig=cardIconFactory(cleanType,!0),iconConfig||(iconConfig=cardIconFactory($scope.data.title,!0))}iconConfig||$scope.data&&$scope.data.vlocityIcon||(iconConfig=cardIconFactory("")),iconConfig&&($scope.sprite=iconConfig.sprite,$scope.icon=iconConfig.icon)}"standard"!=$scope.sprite&&"custom"!=$scope.sprite||($scope.extraClasses+=" slds-icon-"+$scope.sprite+"-"+$scope.icon)}],templateUrl:function(elem,attr){return elem.parent().hasClass("slds-media__figure")?"SldsSvgIcon.tpl.html":"vlocCardIcon.tpl.html"}}});
},{}],7:[function(require,module,exports){
angular.module("CardFramework").directive("vlocCmp",function($compile){"use strict";return{restrict:"E",scope:{cards:"=",customtemplate:"@",data:"=",records:"=",ctrl:"@",loaded:"=?",init:"&",sessionId:"@"},replace:!0,controller:["$scope","$rootScope","$element","$controller","$attrs","force","configService","pageService","$localizable",function($scope,$rootScope,$element,$controller,$attrs,force,configService,pageService,$localizable){function evaluateTemplate(){var foundIt=!1,templateUrl;return angular.forEach($scope.data.templates,function(template){foundIt||("string"==typeof template.filter?eval(template.filter)&&(foundIt=!0,templateUrl=template.templateUrl):$scope.checkFilter($scope.data,template.filter)&&(foundIt=!0,templateUrl=template.templateUrl))}),templateUrl}$scope.params=pageService.params,$scope.attrs=$attrs,$scope.loggedUser=$rootScope.loggedUser?$rootScope.loggedUser:null,$scope.inactiveError={header:$localizable("CardFrameworkInactiveErrorHeader","Error"),errorMsg:$localizable("CardFrameworkInactiveErrorMsg","There is no active instance of"),associationNameLabel:$localizable("CardFrameworkInactiveAssociationNameLabel","associated with"),associationTypeLabel:$localizable("CardFrameworkInactiveAssociationTypeLabel","of type"),associationType:$localizable("CardFrameworkInactiveAssociationTypeCard","component"),contactAdminMsg:$localizable("CardFrameworkContactAdminMsg","Please contact your Salesforce Admin")},$scope.$watch("ready",function(){$scope.ready&&$scope.importedScope&&$scope.importedScope.init()});var innerElement=[],childScope=[];if($scope.ctrl){var injectedScopeModel=$scope.$new();$controller($scope.ctrl,{$scope:injectedScopeModel}),$scope.importedScope=injectedScopeModel}$scope.loadTemplate=function(){var templateUrl;$scope.customtemplate?templateUrl=$scope.customtemplate:(templateUrl=evaluateTemplate(),templateUrl=templateUrl?templateUrl:"card-canvas"),configService.checkIfTemplateIsActive(templateUrl).then(function(ok){var newScope=$scope.$new(!1);childScope.push(newScope);var newElement=$compile("<ng-include src=\"'"+templateUrl+"'\"></ng-include>")(newScope,function(){$scope.ready=!0,$scope.loaded=!0});innerElement.push(newElement),$element.append(newElement)},function(error){if(!$scope.params.previewMode){$scope.inactiveError.inactiveEntityNameLabel=$localizable("CardFrameworkInactiveTemplateNameLabel","Template Name"),$scope.inactiveError.inactiveEntityName=templateUrl,$scope.inactiveError.associationFlag=!0,$scope.inactiveError.associationName=$scope.attrs.name;var newScope=$scope.$new(!1);childScope.push(newScope);var newElement=$compile("<ng-include src=\"'displayInactiveError.tpl.html'\"></ng-include>")(newScope);innerElement.push(newElement),$element.append(newElement)}})},$scope.checkFilter=function(sObject,filterObject){var success=!0;if(!sObject)return success=!1;for(var field in filterObject){if(!sObject.hasOwnProperty(field)||!success)return success=!1;if("object"==typeof sObject[field])success=$scope.checkFilter(sObject[field],filterObject[field]);else{if(!angular.equals(sObject[field],filterObject[field]))return success=!1;console.log("and theyre equal too "+sObject[field])}}return success},childScope.forEach(function(scope){scope.$destroy()}),innerElement.forEach(function(element){element.remove()}),childScope=[],innerElement=[],$element.html(""),$scope.loadTemplate()}],template:"<div></div>"}});
},{}],8:[function(require,module,exports){
angular.module("CardFramework").directive("vlocInput",function($parse,$templateRequest,$compile){"use strict";return{restrict:"A",require:"ngModel",scope:{type:"@",obj:"=",path:"@",ngModel:"=",customTemplate:"@"},link:function(scope,element,attr,ngModel){var objVal=_.get(scope.obj,scope.path);ngModel.$modelValue=objVal,scope.ngModel=ngModel.$modelValue,ngModel.$setViewValue(ngModel.$modelValue),element.attr("value",ngModel.$viewValue),ngModel.$parsers.push(function(value){return value?_.set(scope.obj,scope.path,value):(value=_.get(scope.obj,scope.path),scope.ngModel=_.get(scope.obj,scope.path),ngModel.$setViewValue(value)),value}),ngModel.$render=function(){},scope.customTemplate&&$templateRequest(scope.customTemplate).then(function(html){console.log("requested custom template ",html);var compiledHtml=$compile(html)(scope);console.log(compiledHtml),element.replaceWith(compiledHtml),console.log(element)})}}});
},{}],9:[function(require,module,exports){
angular.module("CardFramework").directive("vlocLayout",function($compile){"use strict";return{restrict:"EA",scope:{cards:"=?",ctrl:"@",customtemplate:"@",useExistingElementType:"@?",data:"=?",layoutName:"@",layoutId:"@",records:"=?",loaded:"=?",parent:"=?",isLoaded:"=?",loadingMore:"=?",sessionId:"@"},replace:!0,controller:["$scope","$rootScope","$element","$window","$log","$controller","$filter","$attrs","$http","force","configService","dataService","pageService","actionService","performAction","$interpolate","$localizable","dataSourceService","$vlocFlyout","$q","parseUri",function($scope,$rootScope,$element,$window,$log,$controller,$filter,$attrs,$http,force,configService,dataService,pageService,actionService,performAction,$interpolate,$localizable,dataSourceService,$vlocFlyout,$q,parseUri){function replaceUrlParam(endpoint,params){var parsed=parseUri(endpoint),output=(parsed.protocol?parsed.protocol+"://":"")+parsed.host+(parsed.port?":"+parsed.port:"")+parsed.path;return(parsed.query||params)&&(params&&!parsed.queryKey&&(parsed.queryKey={}),Object.keys(params).forEach(function(key){params[key]?parsed.queryKey[key]=params[key]:parsed.queryKey[key]&&delete parsed.queryKey[key]}),parsed.query=Object.keys(parsed.queryKey).map(function(key){return key+"="+encodeURIComponent(parsed.queryKey[key])}).join("&")),output+(parsed.query?"?"+parsed.query:"")+(parsed.anchor?"#"+parsed.anchor:"")}function appendOrPrependRecords(newRecords,isAppend){var existingCard;return!!($scope.cards&&$scope.cards.length>0||$scope.initialCardDefinition&&$scope.initialCardDefinition.length>0)&&(existingCard=angular.copy($scope.cards[0])||angular.copy($scope.initialCardDefinition[0]),existingCard.obj=null,$log.debug(isAppend?"Appending ":"Prepending ",existingCard,newRecords),angular.forEach(newRecords,function(record){var newCard=angular.copy(existingCard);newCard.obj=record,isAppend?addCard(newCard,record,null,!0):$scope.cards.unshift(newCard)}),!0)}function handleFrameEvents(e){if(e.data){var frameEventType=e.data.action,frameEventPayload=e.data.data;switch(frameEventType){case"setParent":$scope.$apply(function(){$scope.parent=frameEventPayload});break;default:$log.debug("got a strange message ",e)}}}function loadLayout(src){$log.debug("layout finished loading! "+src,$scope.data),$scope.bypassTemplateRefresh?($scope.isLoaded=!0,$scope.bypassTemplateRefresh=!1):($scope.loadTemplate(),$scope.isLoaded=!0)}function handleLayoutLoaded(layout){var templateNames;return layout?($scope.initialCardDefinition=$scope.initialCardDefinition?$scope.initialCardDefinition:angular.copy(layout.Deck),$scope.order="order",$scope.data=layout,templateNames=[],angular.forEach($scope.data.templates,function(template){templateNames.indexOf(template.templateUrl)===-1&&templateNames.push(template.templateUrl)}),void(!$scope.records&&$scope.data.dataSource?($log.debug($scope.data.dataSource),$scope.isLoaded=!1,dataSourceService.getData($scope.data.dataSource,$scope,$rootScope.forcetkClient).then(function(records){$log.debug("layout got data ",records),$scope.payload=records,$scope.records=dataSourceService.selectResultNode($scope.data.dataSource,records),$scope.evaluateSessionVars(),$log.debug("session variables ",$scope.session),$log.debug("layout records ",$scope.records),setCards(),loadLayout("src")},function(err){$log.debug("data error ",err),loadLayout("bad data")})):(setCards(),$log.debug("datasource null"),loadLayout("other")))):($log.error("configService.getLayout: layout inactive or undefined: "+$scope.layoutName+" - ID was: "+$scope.layoutId),$scope.params.previewMode||($scope.inactiveError.inactiveEntityNameLabel=$localizable("CardFrameworkInactiveLayoutNameLabel","Layout Name"),pageService.params.layout?pageService.params.layout===$scope.layoutName?($scope.inactiveError.inactiveEntityName=pageService.params.layout,$scope.inactiveError.associationFlag=!1):($scope.inactiveError.inactiveEntityName=$scope.layoutName,$scope.inactiveError.associationFlag=!0,$scope.inactiveError.associationName=pageService.params.layout):($scope.inactiveError.inactiveEntityName=$scope.layoutName,$scope.inactiveError.associationFlag=!1),currentTemplateUrl!==templateUrl&&(childScope&&childScope.$destroy(),innerElement&&innerElement.remove(),$element.html(""),childScope=$scope.$new(!1),currentTemplateUrl="displayInactiveError.tpl.html",innerElement=$compile("<ng-include src=\"'displayInactiveError.tpl.html'\"></ng-include>")(childScope),$element.empty().append(innerElement))),$q.when(!0))}function setCards(){$scope.initialCardDefinition?$scope.cards=angular.copy($scope.initialCardDefinition):$scope.cards=layout.Deck?layout.Deck:[],angular.forEach($scope.cards,function(card,order){card.order=order})}function addCard(cardData,sObject,parentCard,appendToEnd){if($log.debug("addCard-----------------------------------------------",$scope),$scope.cards=$scope.cards?$scope.cards:[],$log.debug(cardData),appendToEnd)$scope.cards.push(cardData);else{var cardIndex=$scope.cards.map(function(x){return x.title+x.cardIndex}).indexOf(cardData.title+(cardData.cardIndex-1));$log.debug("::::index of card::::",cardIndex,cardData.title),$scope.cards.length>=cardIndex+1?$scope.cards.splice(cardIndex+1,0,cardData):$scope.cards.push(cardData)}}function evaluateTemplate(){var foundIt=!1;$log.debug("evaluateTemplate layout"),$log.debug($scope.data.templates);var templateUrl;return angular.forEach($scope.data.templates,function(template){foundIt||("string"==typeof template.filter?eval(template.filter)&&(foundIt=!0,templateUrl=template.templateUrl):$scope.checkFilter($scope.data,template.filter)&&(foundIt=!0,templateUrl=template.templateUrl))}),templateUrl}$log=$log.getInstance("CardFramework: vloc-layout"),$log.debug("layout loading: ",$scope.data),$scope.nsPrefix=$rootScope.nsPrefix,$scope.params=pageService.params,$scope.useCache=!pageService.params.useCache||"true"===pageService.params.useCache,$scope.attrs=$attrs,$scope.loggedUser=$rootScope.loggedUser?$rootScope.loggedUser:null,$scope.session={},$scope.inactiveError={header:$localizable("CardFrameworkInactiveErrorHeader","Error"),errorMsg:$localizable("CardFrameworkInactiveErrorMsg","There is no active instance of"),associationNameLabel:$localizable("CardFrameworkInactiveAssociationNameLabel","associated with"),associationTypeLabel:$localizable("CardFrameworkInactiveAssociationTypeLabel","of type"),associationType:$localizable("CardFrameworkInactiveAssociationTypeLayout","layout"),contactAdminMsg:$localizable("CardFrameworkContactAdminMsg","Please contact your Salesforce Admin")};var innerElement=null,childScope=null,currentTemplateUrl=null;$scope.uniqueName="vlocity.layout."+$scope.layoutName,$scope.isLoaded=!1,$scope.loadingMore=!1;var unbindEvents=[];if($scope.$on("$destroy",function(){unbindEvents.forEach(function(fn){fn()})}),$element.on("$destroy",function(){$scope.$destroy()}),$window.addEventListener("message",function(e){$log.debug(e),handleFrameEvents(e)}),unbindEvents[unbindEvents.length]=$scope.$on("reloadLayout",function(event,layoutName){console.info("Layout reload triggered for layout ",layoutName),layoutName&&layoutName===$scope.layoutName&&($scope.records=null,$scope.cards=null,handleLayoutLoaded($scope.data))}),unbindEvents[unbindEvents.length]=$scope.$on("hotkeys.navigation.deselectCard",function(event){$vlocFlyout.hideFlyout()}),unbindEvents[unbindEvents.length]=$scope.$on($scope.uniqueName+".addCard",function(event,data){addCard(data)}),unbindEvents[unbindEvents.length]=$scope.$on($scope.uniqueName+".events",function(event,data){switch($log.debug(data),data.event){case"reload":$log.debug("Layout reload triggered for layout ",$scope.layoutName,data),$scope.reloadLayout2(data.message);break;case"newPayload":$log.debug("Layout reload triggered for layout ",$scope.layoutName,data),$scope.payload=data.message,$scope.records=dataSourceService.selectResultNode($scope.data.dataSource,data.message),$scope.evaluateSessionVars(),$scope.cards=null,handleLayoutLoaded($scope.data),loadLayout("newPayload");break;case"prepend":$log.debug("Layout append triggered for layout ",$scope.layoutName,data),$scope.records||($scope.records=[]),$scope.appendRecords(data.message)!==!1&&($scope.records=$scope.records.unshift(data.message));break;case"append":$log.debug("Layout append triggered for layout ",$scope.layoutName,data),$scope.records||($scope.records=[]),$scope.appendRecords(data.message)!==!1&&($scope.records=$scope.records.concat(data.message));break;case"removeCard":$log.debug("Layout removeCard triggered for layout ",$scope.layoutName,data),$scope.removeCard(data.message);break;case"setLoading":$log.debug("Layout setLoading triggered for layout ",$scope.layoutName,data),$scope.isLoaded=!data.message;break;case"updateDatasource":$log.debug("Layout updateDatasource triggered for layout ",$scope.layoutName,data),$scope.updateDatasource(data.message.params,data.message.appendFlag,data.message.updateSilently,data.message.bypassTemplateRefresh)}}),$scope.reloadLayout2=function(newRecords){return $scope.cards=null,$scope.records=newRecords,$log.debug("layout records ",$scope.records),handleLayoutLoaded($scope.data)},$scope.updateDatasource=function(params,appendFlag,updateSilently,bypassTemplateRefresh){switch($log.debug("updating datasource ",params),$scope.data.dataSource.type){case"Query":$scope.data.dataSource.value.query=params.query||$scope.data.dataSource.value.query;break;case"ApexRemote":angular.forEach(params,function(paramVal,paramKey){$scope.data.dataSource.value.inputMap[paramKey]=paramVal});break;case"Dual":if("undefined"!=typeof Visualforce){angular.forEach(params,function(paramVal,paramKey){$scope.data.dataSource.value.inputMap[paramKey]=paramVal});break}case"REST":case"ApexRest":$scope.data.dataSource.value.endpoint=replaceUrlParam($scope.data.dataSource.value.endpoint,params);break;default:$log.debug("update datasource not supported for "+$scope.data.dataSource.type)}return updateSilently?$q.when(!0):($log.debug("new datasource:",$scope.data.dataSource),$scope.bypassTemplateRefresh="undefined"==typeof bypassTemplateRefresh||bypassTemplateRefresh,appendFlag?($scope.loadingMore=!0,dataSourceService.getData($scope.data.dataSource,$scope,$rootScope.forcetkClient).then(function(records){$log.debug("layout append got data ",records),$scope.payload=records,$scope.loadingMore=!1,$log.debug("payload ",$scope.payload);var recordsToAppend=dataSourceService.selectResultNode($scope.data.dataSource,records);return $scope.evaluateSessionVars(),console.log("session variables ",$scope.session),$scope.records||($scope.records=[]),$scope.appendRecords(recordsToAppend)!==!1&&($scope.records=$scope.records.concat(recordsToAppend)),$scope.records},function(err){$log.debug("data error ",err),loadLayout("bad data"),$scope.loadingMore=!1})):$scope.reloadLayout2())},$scope.prependRecords=function(newRecords){appendOrPrependRecords(newRecords,!1)},$scope.appendRecords=function(newRecords){appendOrPrependRecords(newRecords,!0)},$scope.removeCard=function(card,isSoftRemoval){$log.debug("removing card ",card,card.cardIndex),card.deleteCard(),$scope.cards.splice(card.cardIndex,1),isSoftRemoval||angular.forEach($scope.records,function(record,index){if(record===card.obj)return $scope.records.splice(index,1),!1})},null==$scope.layoutId||/^\s*$/.test($scope.layoutId)?configService.getLayoutByName($scope.layoutName,$scope.useCache).then(handleLayoutLoaded):configService.getLayoutById($scope.layoutId).then(handleLayoutLoaded),$scope.evaluateSessionVars=function(){angular.forEach($scope.data.sessionVars,function(sessionVar){try{$log.debug("var name ",sessionVar),$scope.session[sessionVar.name]=$interpolate("{{"+sessionVar.val+"}}")($scope),$log.debug("session var ",$scope.session);var parsedVar=JSON.parse($scope.session[sessionVar.name]);$scope.session[sessionVar.name]=parsedVar}catch(e){$log.debug("could not set ",sessionVar,e)}}),$log.debug("session variables",$scope.session)},$scope.flyoutArrowLeftPos=0,$rootScope.selectCard=function(cardIndex){$vlocFlyout.hideFlyout(),$rootScope.selected=cardIndex.split("-")[1]},$scope.performAction=function(action){return performAction(action,$scope.obj,$scope.records,$scope.data.filter,$scope.records.pickedState)},$scope.ctrl){$log.debug("loading "+$scope.ctrl);var injectedScopeModel=$scope.$new();$controller($scope.ctrl,{$scope:injectedScopeModel}),$scope.importedScope=injectedScopeModel,$log.debug("importedScope ",$scope.importedScope),$scope.importedScope.init&&$scope.importedScope.init()}$scope.setOrder=function(order){$log.debug("setting order"),$scope.order=order},$scope.searchFunc=function(cardObj,searchToken){return function(card){var searchedObj=[card.obj],searchToken=searchToken||$scope.searchTerm,matches=$filter("filter")(searchedObj,searchToken);return matches.length>0}},$scope.loadTemplate=function(){var templateUrl,layoutType,hotkeyLayoutAttr="hotkeys-layout-navigation";$scope.customtemplate?($log.debug("loading custom template "+$scope.customtemplate),templateUrl=$scope.customtemplate):(templateUrl=evaluateTemplate(),templateUrl=templateUrl?templateUrl:"card-canvas"),$log.debug("loading layout template "+templateUrl),configService.checkIfTemplateIsActive(templateUrl).then(function(ok){layoutType=$scope.data&&$scope.data[$rootScope.nsPrefix+"Type__c"],layoutType&&"flyout"===layoutType.toLowerCase()&&(hotkeyLayoutAttr=""),currentTemplateUrl!==templateUrl&&(childScope&&childScope.$destroy(),innerElement&&innerElement.remove(),$element.html(""),childScope=$scope.$new(!1),currentTemplateUrl=templateUrl,innerElement=$compile("<ng-include src=\"'"+templateUrl+"'\" "+hotkeyLayoutAttr+"></ng-include>")(childScope),$element.empty().append(innerElement))},function(error){$scope.params.previewMode||($scope.inactiveError.inactiveEntityNameLabel=$localizable("CardFrameworkInactiveTemplateNameLabel","Template Name"),$scope.inactiveError.inactiveEntityName=templateUrl,$scope.inactiveError.associationFlag=!0,$scope.inactiveError.associationName=$scope.layoutName,currentTemplateUrl!==templateUrl&&(childScope&&childScope.$destroy(),innerElement&&innerElement.remove(),$element.html(""),childScope=$scope.$new(!1),currentTemplateUrl="displayInactiveError.tpl.html",innerElement=$compile("<ng-include src=\"'displayInactiveError.tpl.html'\"></ng-include>")(childScope),$element.empty().append(innerElement)))})},$scope.checkFilter=function(sObject,filterObject){var success=!0;if($log.debug("check filter"),$log.debug(sObject),$log.debug(filterObject),!sObject)return success=!1;for(var field in filterObject){if(!sObject.hasOwnProperty(field)||!success)return success=!1;if("object"==typeof sObject[field])success=$scope.checkFilter(sObject[field],filterObject[field]);else{if(!angular.equals(sObject[field],filterObject[field]))return success=!1;$log.debug("and theyre equal too "+sObject[field])}}return success}}],template:function(tElement,tAttrs){return null!=tAttrs.useExistingElementType?"<"+tElement[0].localName+"></"+tElement[0].localName+">":"<div></div>"}}});
},{}],10:[function(require,module,exports){
angular.module("CardFramework").provider("actionLauncher",function(){var defaultWindowOpen=function(url,params){window.open(url,params)},windowOpen=defaultWindowOpen;this.setCustomWindowOpen=function(customWindowOpen){windowOpen=customWindowOpen},this.$get=function($rootScope,dataService,actionService,$injector){"use strict";function openActionUrl(action,actionConfig){var selRecordEvent,openSubtab,openSuccess,primaryTabId,toBeLaunchedUrl,basicUrl,externalUrl=!1,openUrlMode=action[$rootScope.nsPrefix+"OpenUrlMode__c"]||action[$rootScope.nsPrefix+"OpenURLMode__c"]||action.openUrlIn,pathValid=(action[$rootScope.nsPrefix+"InvokeClassName__c"],action[$rootScope.nsPrefix+"InvokeMethodName__c"],new RegExp("^(?:[a-z]+:)?//","i")),communityUrl=localStorage.getItem("currentInstanceUrlWithPath"),params="New Tab / Window"===openUrlMode?"_blank":"_self";if(toBeLaunchedUrl=action[$rootScope.nsPrefix+"Url__c"]||action[$rootScope.nsPrefix+"URL__c"]||action.url,actionConfig&&actionConfig.extraParams&&angular.forEach(actionConfig.extraParams,function(paramVal,paramKey){toBeLaunchedUrl=replaceUrlParam(toBeLaunchedUrl,paramKey,paramVal)}),basicUrl=toBeLaunchedUrl,console.log("Opening action url"+toBeLaunchedUrl),!toBeLaunchedUrl)return console.error("actionLauncher.invoke :: Vlocity action url not found for this action",action),!1;if(pathValid.test(toBeLaunchedUrl)?(externalUrl=!0,console.log("external url: "+toBeLaunchedUrl)):toBeLaunchedUrl=communityUrl?communityUrl+toBeLaunchedUrl:toBeLaunchedUrl,selRecordEvent=$rootScope.$$listeners.actionSelected)console.log("firing event :: actionSelected"),$rootScope.showContent=!1,$rootScope.$broadcast("actionSelected",toBeLaunchedUrl);else if("undefined"!=typeof sforce)if(sforce.console.isInConsole()&&!externalUrl&&"_blank"===params)openSubtab=function(result){primaryTabId=result.id,sforce.console.openSubtab(primaryTabId,toBeLaunchedUrl,!1,action.displayName,null,openSuccess,action.displayName)},openSuccess=function(result){sforce.console.focusSubtabById(result.id)},sforce.console.getEnclosingPrimaryTabId(openSubtab);else if("object"==typeof sforce.one)if("_blank"===params){var lightningRedirect='{"componentDef":"one:alohaPage","attributes":{"values":{"address":"'+basicUrl+'"},"history":[]},"t":'+Date.now()+"}",lightningInstanceUrl="/one/one.app#"+window.btoa(lightningRedirect);windowOpen(lightningInstanceUrl,params)}else sforce.one.navigateToURL(toBeLaunchedUrl,!1);else windowOpen(toBeLaunchedUrl,params);else windowOpen(toBeLaunchedUrl,params)}function replaceUrlParam(endpoint,paramName,paramValue){var pattern=new RegExp("\\b("+paramName+"=).*?(&|$)");return endpoint.search(pattern)>=0?endpoint.replace(pattern,"$1"+paramValue+"$2"):endpoint+(endpoint.indexOf("?")>0?"&":"?")+paramName+"="+paramValue}windowOpen!==defaultWindowOpen&&(windowOpen=windowOpen($injector));var launchAction=function(action,actionConfig){var className=action[$rootScope.nsPrefix+"InvokeClassName__c"],classMethod=action[$rootScope.nsPrefix+"InvokeMethodName__c"],redirectByContext=!!actionConfig&&actionConfig.contextRedirectFlag,actionCallback=actionConfig?actionConfig.showLoadingSpinner:null;if(actionCallback&&actionCallback(),className&&classMethod){var inputMap={};inputMap.contextId=action.contextId,dataService.doGenericInvoke(className,classMethod,angular.toJson(inputMap),null).then(function(data){if(redirectByContext)try{var device=window.outerWidth>768?"Web Client":"Mobile",objId=data.records[0].id||data.records[0].Id,objType=data.records[0].objectType||"All",soRecord={Id:objId};actionService.getActions(objType,soRecord,device,null,$rootScope.forcetkClient).then(function(reloadActions){reloadActions.length>0&&angular.forEach(reloadActions,function(reloadAction){if(reloadAction.name===action.Name)return actionCallback&&actionCallback(),void openActionUrl(reloadAction,actionConfig)})})}catch(e){console.log("error redirecting action ",e),openActionUrl(action,actionConfig)}else actionCallback&&actionCallback(),openActionUrl(action,actionConfig)},function(err){console.error("action err ",err),actionCallback&&actionCallback(),openActionUrl(action,actionConfig)})}else actionCallback&&actionCallback(),openActionUrl(action,actionConfig)};return{invoke:function(action,actionConfig){launchAction(action,actionConfig)}}}});
},{}],11:[function(require,module,exports){
angular.module("CardFramework").provider("cardIconFactory",function(){function makeCustomIcon(iconNumber){return{sprite:"custom",icon:"custom"+iconNumber}}function makeStandardIcon(iconName){return{sprite:"standard",icon:iconName}}var standard=["account","announcement","approval","apps","article","avatar","calibration","call","campaign","campaign_members","canvas","case","case_change_status","case_comment","case_email","case_log_a_call","case_transcript","client","coaching","connected_apps","contact","contract","custom","dashboard","default","document","drafts","email","email_IQ","email_chatter","empty","endorsement","environment_hub","event","feed","feedback","file","flow","folder","generic_loading","goals","group_loading","groups","hierarchy","home","household","insights","investment_account","lead","link","log_a_call","marketing_actions","metrics","news","note","opportunity","orders","people","performance","person_account","photo","poll","portal","post","pricebook","process","product","question_best","question_feed","quotes","recent","record","related_list","report","reward","scan_card","skill_entity","social","solution","sossession","task","task2","team_member","thanks","thanks_loading","today","topic","unmatched","user","work_order","work_order_item"],iconMap={claim:makeCustomIcon(41),"campaign member action log":makeStandardIcon("call"),asset:makeCustomIcon(75),"asset landline":makeCustomIcon(22),"asset internet":makeCustomIcon(68),"asset tv":makeCustomIcon(99),"asset mobile":makeCustomIcon(28),"asset support":makeStandardIcon("question_feed"),"asset internet+tv":makeCustomIcon(22),"asset accessories":makeCustomIcon(22),"asset security":makeCustomIcon(77),"asset wireless":makeCustomIcon(30),policy:makeCustomIcon(91),"policy ad&d":makeCustomIcon(1),"policy auto":makeCustomIcon(31),"policy boatowners":makeCustomIcon(88),"policy boat":makeCustomIcon(88),"policy business owners":makeCustomIcon(32),"policy condominium":makeCustomIcon(24),"policy crime":makeCustomIcon(91),"policy d&o":makeCustomIcon(32),"policy equity−indexed annuity":makeCustomIcon(16),"policy fixed annuity":makeCustomIcon(16),"policy general liability":makeCustomIcon(16),"policy homeowners":makeStandardIcon("home"),"policy inland marine":makeCustomIcon(98),"policy motorcycle":makeCustomIcon(98),"policy ocean marine":makeCustomIcon(92),"policy permanent life":makeCustomIcon(1),"policy pers/scheduled property":makeCustomIcon(43),"policy property":makeStandardIcon("home"),"policy renters":makeStandardIcon("person_account"),"policy term life":makeCustomIcon(1),"policy umbrella liability":makeCustomIcon(60),"policy unit linked life":makeCustomIcon(1),"policy universal life":makeCustomIcon(1),"policy universal variable life":makeCustomIcon(1),"policy variable annuity":makeCustomIcon(16),"policy variable life":makeCustomIcon(1),"policy workers compensation":makeCustomIcon(32)};Object.keys(iconMap).forEach(function(keyInMap){/^policy/.test(keyInMap)&&(iconMap["non held "+keyInMap]=iconMap[keyInMap])}),standard.forEach(function(icon){iconMap[icon]=makeStandardIcon(icon)}),this.applyIconMapping=function(key,sprite,icon){angular.isObject(key)?Object.keys(key).forEach(function(keyInMap){iconMap[keyInMap]=key[keyInMap]}):iconMap[key]={sprite:sprite,icon:icon}},this.$get=function(){return function(objectType,noDefault){for(var found=null,objectTypeParts=objectType.split(" ");!found&&objectTypeParts.length>0;)found=iconMap[objectTypeParts.join(" ").toLowerCase()],objectTypeParts.pop();return found?found:noDefault?null:{sprite:"custom",icon:"custom91"}}}});
},{}],12:[function(require,module,exports){
angular.module("CardFramework").factory("configService",function(remoteActions,force,$rootScope,nameSpaceService,debugService,$q,vlocTemplateInternalCache,$log){"use strict";function makeErrorHandler(message){return function(error){throw console.error?console.error(message,error):$log.debug(message,error),error}}$log=$log.getInstance("CardFramework: configService");var convertStringArray2SoqlInClause=function(strArray){if(0===strArray.length)return null;for(var returnStr="(",i=0;i<strArray.length;i++)returnStr+="'"+strArray[i]+"'",i<strArray.length-1&&(returnStr+=",");return returnStr+=")"};return{checkIfTemplateIsActive:function(templateUrl){var q=$q.defer();if(vlocTemplateInternalCache.names)return vlocTemplateInternalCache.names.indexOf(templateUrl)>-1?q.resolve("ok"):q.reject("error"),q.promise;var checkInterval=setInterval(function(){vlocTemplateInternalCache.names&&(vlocTemplateInternalCache.names.indexOf(templateUrl)>-1?q.resolve("ok"):q.reject("error"),clearInterval(checkInterval))},100);return q.promise},getLayouts:function(){return $log.debug("calling configService: getLayouts()"),remoteActions.getLayouts&&"undefined"!=typeof Visualforce?remoteActions.getLayouts():nameSpaceService.getNameSpacePrefix().then(function(nsPrefix){return $log.debug("getLayouts(): nsPrefix: "+nsPrefix),force.query("SELECT Id, Name, "+nsPrefix+"Definition__c,"+nsPrefix+"Description__c,"+nsPrefix+"Active__c,"+nsPrefix+"Type__c,"+nsPrefix+"Version__c, CreatedDate, CreatedBy.Name, LastModifiedDate, LastModifiedBy.Name FROM "+nsPrefix+"VlocityUILayout__c ORDER BY Name").then(function(data){var layouts=data.records,layoutList=[];return angular.forEach(layouts,function(layout){layout[nsPrefix+"Definition__c"]=JSON.parse(layout[nsPrefix+"Definition__c"]),layoutList.push(layout)}),layoutList},makeErrorHandler("layouts retrieval error: "))})},getLayoutByName:function(layoutName,useCache){var layoutDefinitionJsonFromCache,layoutDefinitionStringFromCache=sessionStorage.getItem("layout::"+layoutName),q=$q.defer();if(useCache&&layoutDefinitionStringFromCache)return layoutDefinitionJsonFromCache=JSON.parse(layoutDefinitionStringFromCache),q.resolve(layoutDefinitionJsonFromCache),q.promise;if("undefined"!=typeof remoteActions&&null!==remoteActions&&remoteActions.getLayout&&remoteActions.getCardsByNames&&"undefined"!=typeof Visualforce)return this.getLayoutViaRemoting("Name",layoutName);var searchCriterion=" WHERE Name = '"+layoutName+"'";return this.getLayoutViaApi("Name",searchCriterion).then(function(layout){return layout})},getLayoutById:function(layoutId){if("undefined"!=typeof remoteActions&&null!==remoteActions&&remoteActions.getLayout&&remoteActions.getCardsByNames&&"undefined"!=typeof Visualforce)return this.getLayoutViaRemoting("Id",layoutId).then(function(layout){return layout});var searchCriterion=" WHERE Id = '"+layoutId+"'";return this.getLayoutViaApi("Id",searchCriterion).then(function(layout){return layout})},getLayoutViaRemoting:function(searchCriterionType,searchParam){return nameSpaceService.getNameSpacePrefix().then(function(nsPrefix){return debugService.displayNameSpacePrefix("getLayoutViaRemoting",nsPrefix),remoteActions.getLayout(searchCriterionType,searchParam).then(function(data){if(data.length>0){for(var layout=data[0];"object"!=typeof layout[nsPrefix+"Definition__c"]&&"undefined"!=typeof layout[nsPrefix+"Definition__c"];)layout[nsPrefix+"Definition__c"]=JSON.parse(layout[nsPrefix+"Definition__c"]);layout[nsPrefix+"Definition__c"]||(layout[nsPrefix+"Definition__c"]={templates:[],dataSource:[],Cards:[]}),layout.templates=layout[nsPrefix+"Definition__c"].templates,layout.dataSource=layout[nsPrefix+"Definition__c"].dataSource,layout.Loaded=!1,layout.session={},layout.sessionVars=layout[nsPrefix+"Definition__c"].sessionVars||[];var cardNames=layout[nsPrefix+"Definition__c"].Cards||[];return cardNames.length>0?remoteActions.getCardsByNames(cardNames).then(function(data){var cards=data;return layout.Deck=new Array(cards.length),angular.forEach(cards,function(card){var cardDefinition={Cards:[]};card[nsPrefix+"Definition__c"]&&(cardDefinition=JSON.parse(card[nsPrefix+"Definition__c"])),cardDefinition.layoutName="vlocity.layout."+layout.Name,card[nsPrefix+"Definition__c"]=cardDefinition;var cardIndex=layout[nsPrefix+"Definition__c"].Cards.indexOf(card.Name);cardIndex>-1&&(layout.Deck[cardIndex]=cardDefinition)}),layout.Deck=layout.Deck.filter(function(card){return null!==card}),sessionStorage.setItem("layout::"+layout.Name,JSON.stringify(layout)),layout},makeErrorHandler("cards retrieval error: ")):(layout.Deck=[],sessionStorage.setItem("layout::"+layout.Name,JSON.stringify(layout)),layout.Loaded=!0,layout)}return null},makeErrorHandler("layouts retrieval error: "))})},getLayoutViaApi:function(searchCriterionType,searchCriterion){return nameSpaceService.getNameSpacePrefix().then(function(nsPrefix){debugService.displayNameSpacePrefix("getLayoutViaApi",nsPrefix);var soqlQuery,baseQuery="SELECT Id, Name, "+nsPrefix+"Definition__c,"+nsPrefix+"Description__c,"+nsPrefix+"Active__c,"+nsPrefix+"Type__c,"+nsPrefix+"Version__c, CreatedDate, CreatedBy.Name, LastModifiedDate, LastModifiedBy.Name FROM "+nsPrefix+"VlocityUILayout__c",activeCriterion=" AND "+nsPrefix+"Active__c = True";return soqlQuery="Name"===searchCriterionType?baseQuery+searchCriterion+activeCriterion:baseQuery+searchCriterion,force.query(soqlQuery).then(function(data){if(data.records.length>0){for(var layout=data.records[0];"object"!=typeof layout[nsPrefix+"Definition__c"];)layout[nsPrefix+"Definition__c"]=JSON.parse(layout[nsPrefix+"Definition__c"]);layout.templates=layout[nsPrefix+"Definition__c"].templates,layout.dataSource=layout[nsPrefix+"Definition__c"].dataSource,layout.Loaded=!1,layout.session={},layout.sessionVars=layout[nsPrefix+"Definition__c"].sessionVars||[];var cardNames=layout[nsPrefix+"Definition__c"].Cards||[];if(cardNames.length>0){var cardsSoql="SELECT Id, Name, "+nsPrefix+"Type__c, "+nsPrefix+"Definition__c, LastModifiedDate FROM "+nsPrefix+"VlocityCard__c WHERE Name IN ",inClause=convertStringArray2SoqlInClause(cardNames),cardsSoqlWithInClause=cardsSoql+inClause;return force.query(cardsSoqlWithInClause).then(function(data){var cards=data.records;return layout.Deck=new Array(cards.length),angular.forEach(cards,function(card){var cardDefinition={Cards:[]};card[nsPrefix+"Definition__c"]&&(cardDefinition=JSON.parse(card[nsPrefix+"Definition__c"])),cardDefinition.layoutName="vlocity.layout."+layout.Name,card[nsPrefix+"Definition__c"]=cardDefinition;var cardIndex=layout[nsPrefix+"Definition__c"].Cards.indexOf(card.Name);cardIndex>-1&&(layout.Deck[cardIndex]=cardDefinition)}),layout.Deck=layout.Deck.filter(function(card){return null!==card}),sessionStorage.setItem("layout::"+layout.Name,JSON.stringify(layout)),layout.Loaded=!0,layout},function(error){$log.debug("cards retrieval error: "+error)})}return sessionStorage.setItem("layout::"+layout.Name,JSON.stringify(layout)),layout.Loaded=!0,layout}return null},makeErrorHandler("layouts retrieval error: "))})},getCards:function(){return nameSpaceService.getNameSpacePrefix().then(function(nsPrefix){return debugService.displayNameSpacePrefix("getCards",nsPrefix),"undefined"!=typeof remoteActions&&null!==remoteActions&&remoteActions.getCards&&"undefined"!=typeof Visualforce?remoteActions.getCards().then(function(cards){return cards},makeErrorHandler("getCards retrieval error: ")):force.query("SELECT Id, Name, "+nsPrefix+"Type__c, "+nsPrefix+"Definition__c, LastModifiedDate FROM "+nsPrefix+"VlocityCard__c").then(function(data){var cards=data.records;return cards},makeErrorHandler("getCards retrieval error: "))})},getCardByName:function(cardName,useCache){var cardDefinitionJsonFromCache,cardDefinitionStringFromCache=sessionStorage.getItem("card::"+cardName),q=$q.defer();return useCache&&cardDefinitionStringFromCache?(cardDefinitionJsonFromCache=JSON.parse(cardDefinitionStringFromCache),q.resolve(cardDefinitionJsonFromCache),q.promise):nameSpaceService.getNameSpacePrefix().then(function(nsPrefix){if(debugService.displayNameSpacePrefix("getCardByName",nsPrefix),"undefined"!=typeof remoteActions&&null!==remoteActions&&remoteActions.getCardByName&&"undefined"!=typeof Visualforce)return remoteActions.getCardByName(cardName).then(function(card){if(card){var cardDefinitionString=card[nsPrefix+"Definition__c"];return sessionStorage.setItem("card::"+cardName,cardDefinitionString),JSON.parse(cardDefinitionString)}return null},makeErrorHandler("getCardByName retrieval error: "));var soql="SELECT Id, Name, "+nsPrefix+"Type__c, "+nsPrefix+"Definition__c, LastModifiedDate FROM "+nsPrefix+"VlocityCard__c WHERE Name = '"+cardName+"'";return force.query(soql).then(function(data){if(data.records.length>0){var card=data.records[0],cardDefinitionString=card[nsPrefix+"Definition__c"];return sessionStorage.setItem("card::"+cardName,cardDefinitionString),JSON.parse(cardDefinitionString)}return null},makeErrorHandler("getCardByName retrieval error: "))})},saveObject:function(object,sObjectName){return $log.debug("calling configService: saveObject() ",sObjectName,object),nameSpaceService.getNameSpacePrefix().then(function(nsPrefix){return debugService.displayNameSpacePrefix("saveObject",nsPrefix),null==object.Id?force.create(sObjectName,object):(delete object.LastModifiedDate,delete object.CreatedDate,delete object.CreatedBy,delete object.LastModifiedBy,force.update(sObjectName,object))})},deleteObject:function(object,sObjectName){return $log.debug("calling configService: deleteObject()"),nameSpaceService.getNameSpacePrefix().then(function(nsPrefix){return debugService.displayNameSpacePrefix("deleteObject",nsPrefix),force.del(nsPrefix+sObjectName,object.Id).then(function(response){return $log.debug("deleteObject "+sObjectName+" successful: response: "+response),response},function(error){$log.debug("deleteObject "+sObjectName+" failure error: "+error),$log.debug(error)})})},getStaticResourcesUrl:function(){return"undefined"!=typeof remoteActions&&null!==remoteActions&&remoteActions.getStaticResourcesUrl&&"undefined"!=typeof Visualforce?remoteActions.getStaticResourcesUrl().then(function(resources){return JSON.parse(resources)},makeErrorHandler("getStaticResourcesUrl retrieval error: ")):force.query("SELECT Name, NamespacePrefix, SystemModStamp FROM StaticResource").then(function(data){var resourceList=data.records,resourceMap={};return angular.forEach(resourceList,function(st){var namespace=st.NamespacePrefix,systemTimeStamp=new Date(st.SystemModstamp),systemTimeStampInSec=systemTimeStamp.getTime();resourceMap[st.Name]="/resource/"+systemTimeStampInSec+"/"+(null!==namespace&&""!==namespace?namespace+"__":"")+st.Name}),resourceMap},makeErrorHandler("getStaticResourcesUrl retrieval error: "))},getNamedCredentials:function(){return force.query("SELECT DeveloperName,Endpoint,Id,Language,MasterLabel,NamespacePrefix,PrincipalType FROM NamedCredential LIMIT 10000").then(function(data){var credentials=data.records;return $log.debug("getNamedCredentials completed"),credentials},makeErrorHandler("getNamedCredentials retrieval error: "))}}});
},{}],13:[function(require,module,exports){
angular.module("CardFramework").factory("parseUri",function(){"use strict";return function(str){for(var o={strictMode:!1,key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}},m=o.parser[o.strictMode?"strict":"loose"].exec(str),uri={},i=14;i--;)uri[o.key[i]]=m[i]||"";return uri[o.q.name]={},uri[o.key[12]].replace(o.q.parser,function($0,$1,$2){$1&&(uri[o.q.name][$1]=$2)}),uri}});
},{}],14:[function(require,module,exports){
angular.module("CardFramework").factory("performAction",function($rootScope,actionLauncher,actionService,$log){"use strict";return function(action,actionConfig,obj,data,filter,pickedState){var objType="All",soRecord=data.actionCtxId?{Id:data.actionCtxId}:obj&&obj.Id?{Id:obj.Id}:null,device=window.outerWidth>768?"Web Client":"Mobile";action[$rootScope.nsPrefix+"UrlParameters__c"]?(pickedState&&pickedState.sObjectType?objType=pickedState.sObjectType:obj&&obj.attributes&&obj.attributes.type&&(objType=obj.attributes.type),actionService.getActions(objType,soRecord,device,null,$rootScope.forcetkClient,$log).then(function(actions){var clonedAction=angular.copy(action);actions.forEach(function(actionObj){clonedAction.Id===actionObj.id&&actionObj.url&&(clonedAction[$rootScope.nsPrefix+"Url__c"]=actionObj.url,clonedAction[$rootScope.nsPrefix+"URL__c"]=actionObj.url,clonedAction.contextId=soRecord?soRecord.Id:null)}),actionLauncher.invoke(clonedAction,actionConfig)})):actionLauncher.invoke(action,actionConfig)}});
},{}],15:[function(require,module,exports){
angular.module("CardFramework").run(["$templateCache",function($templateCache){"use strict";$templateCache.put("displayInactiveError.tpl.html",'<div class=\'panel panel-default script-not-found\'>\n    <div class=\'panel-body\'>\n        <div class="text-danger">\n            <span class="icon-v-close-circle"></span>\n            <b class="has-error">{{inactiveError.header}}:</b>\n        </div>\n        <br/>\n        <div>\n            <label>{{inactiveError.errorMsg}}</label>\n            <br/>\n            <div>\n                <span>\n                    <b>{{inactiveError.inactiveEntityNameLabel}}: </b><label>{{inactiveError.inactiveEntityName}}</label>\n                    <br/>\n                </span>\n                <span ng-if="inactiveError.associationFlag">\n                    <b>{{inactiveError.associationNameLabel}}: </b><label>{{inactiveError.associationName}}</label>\n                    <br/>\n                    <b>{{inactiveError.associationTypeLabel}}: </b><label>{{inactiveError.associationType}}</label>\n                </span>\n            </div>\n            <br/>\n            <label>{{inactiveError.contactAdminMsg}}</label>\n        </div>\n    </div>\n</div>'),$templateCache.put("vlocCardIcon.tpl.html","<span ng-class=\"(!sprite || !icon) && data.vlocityIcon ? 'icon ' + data.vlocityIcon + ' ' + extraClasses : 'slds-icon__container ' + (sprite == 'standard' || sprite == 'custom' ? 'slds-icon-' + sprite + '-' + icon : '')\">\n"+'    <slds-svg-icon sprite="sprite" icon="icon" size="size" extra-classes="extraClasses" no-hint="true" ng-if="sprite && icon"></slds-svg-icon>\n</span>')}]);
},{}]},{},[1]);

})();